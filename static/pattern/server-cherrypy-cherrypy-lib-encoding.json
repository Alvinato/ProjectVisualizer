{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/lib/encoding.py", "lines": [{"index": "1", "colour": "orange", "code": "import struct\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "orange", "code": "import time\n", "error": "none", "author": "tom@organisms.be"}, {"index": "3", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "4", "colour": "orange", "code": "import cherrypy\n", "error": "none", "author": "tom@organisms.be"}, {"index": "5", "colour": "green", "code": "from cherrypy._cpcompat import basestring, BytesIO, ntob, set, unicodestr\n", "error": "W", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "from cherrypy.lib import file_generator\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "orange", "code": "from cherrypy.lib import set_vary_header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "def decode(encoding=None, default_encoding='utf-8'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "    \"\"\"Replace or extend the list of charsets used to decode a request entity.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "orange", "code": "    Either argument may be a single string or a list of strings.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "    encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "        If not None, restricts the set of charsets attempted while decoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "        a request entity to the given set (even if a different charset is given in\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "        the Content-Type request header).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "    default_encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "        Only in effect if the 'encoding' argument is not given.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "orange", "code": "        If given, the set of charsets attempted while decoding a request entity is\n", "error": "none", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "        *extended* with the given value(s).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "    body = cherrypy.request.body\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "    if encoding is not None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "        if not isinstance(encoding, list):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "orange", "code": "            encoding = [encoding]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "        body.attempt_charsets = encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "orange", "code": "    elif default_encoding:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "        if not isinstance(default_encoding, list):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "orange", "code": "            default_encoding = [default_encoding]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "        body.attempt_charsets = body.attempt_charsets + default_encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "36", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "class ResponseEncoder:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "    default_encoding = 'utf-8'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "orange", "code": "    failmsg = \"Response body could not be encoded with %r.\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "    encoding = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "orange", "code": "    errors = 'strict'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "43", "colour": "orange", "code": "    text_only = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "    add_charset = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "orange", "code": "    debug = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "orange", "code": "    def __init__(self, **kwargs):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "        for k, v in kwargs.items():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "orange", "code": "            setattr(self, k, v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "        self.attempted_charsets = set()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "        if request.handler is not None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "            # Replace request.handler with self\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "                cherrypy.log('Replacing request.handler', 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "            self.oldhandler = request.handler\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "            request.handler = self\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "    def encode_stream(self, encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "        \"\"\"Encode a streaming response body.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "        Use a generator wrapper, and just pray it works as the stream is\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "        being written out.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "        \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "        if encoding in self.attempted_charsets:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "            return False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "        self.attempted_charsets.add(encoding)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "        def encoder(body):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "orange", "code": "            for chunk in body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "72", "colour": "orange", "code": "                if isinstance(chunk, unicodestr):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "                    chunk = chunk.encode(encoding, self.errors)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "                yield chunk\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "green", "code": "        self.body = encoder(self.body)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "        return True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "orange", "code": "    def encode_string(self, encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "        \"\"\"Encode a buffered response body.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "        if encoding in self.attempted_charsets:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "            return False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "        self.attempted_charsets.add(encoding)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "            body = []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "            for chunk in self.body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "orange", "code": "                if isinstance(chunk, unicodestr):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "                    chunk = chunk.encode(encoding, self.errors)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "                body.append(chunk)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "green", "code": "            self.body = body\n", "error": "W", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "        except (LookupError, UnicodeError):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "92", "colour": "orange", "code": "            return False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "93", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "94", "colour": "orange", "code": "            return True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "95", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "96", "colour": "blue", "code": "    def find_acceptable_charset(self):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "97", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "98", "colour": "orange", "code": "        response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "99", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "100", "colour": "orange", "code": "        if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "101", "colour": "orange", "code": "            cherrypy.log('response.stream %r' % response.stream, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "102", "colour": "orange", "code": "        if response.stream:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "103", "colour": "orange", "code": "            encoder = self.encode_stream\n", "error": "none", "author": "tom@organisms.be"}, {"index": "104", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "105", "colour": "orange", "code": "            encoder = self.encode_string\n", "error": "none", "author": "tom@organisms.be"}, {"index": "106", "colour": "orange", "code": "            if \"Content-Length\" in response.headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "107", "colour": "orange", "code": "                # Delete Content-Length header so finalize() recalcs it.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "108", "colour": "orange", "code": "                # Encoded strings may be of different lengths from their\n", "error": "none", "author": "tom@organisms.be"}, {"index": "109", "colour": "orange", "code": "                # unicode equivalents, and even from each other. For example:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "110", "colour": "orange", "code": "                # >>> t = u\"\\u7007\\u3040\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "111", "colour": "orange", "code": "                # >>> len(t)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "112", "colour": "orange", "code": "                # 2\n", "error": "none", "author": "tom@organisms.be"}, {"index": "113", "colour": "orange", "code": "                # >>> len(t.encode(\"UTF-8\"))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "114", "colour": "orange", "code": "                # 6\n", "error": "none", "author": "tom@organisms.be"}, {"index": "115", "colour": "orange", "code": "                # >>> len(t.encode(\"utf7\"))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "116", "colour": "orange", "code": "                # 8\n", "error": "none", "author": "tom@organisms.be"}, {"index": "117", "colour": "orange", "code": "                del response.headers[\"Content-Length\"]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "118", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "119", "colour": "orange", "code": "        # Parse the Accept-Charset request header, and try to provide one\n", "error": "none", "author": "tom@organisms.be"}, {"index": "120", "colour": "orange", "code": "        # of the requested charsets (in order of user preference).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "121", "colour": "orange", "code": "        encs = request.headers.elements('Accept-Charset')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "122", "colour": "orange", "code": "        charsets = [enc.value.lower() for enc in encs]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "123", "colour": "orange", "code": "        if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "124", "colour": "orange", "code": "            cherrypy.log('charsets %s' % repr(charsets), 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "125", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "126", "colour": "orange", "code": "        if self.encoding is not None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "127", "colour": "orange", "code": "            # If specified, force this encoding to be used, or fail.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "128", "colour": "orange", "code": "            encoding = self.encoding.lower()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "129", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "130", "colour": "orange", "code": "                cherrypy.log('Specified encoding %r' % encoding, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "131", "colour": "orange", "code": "            if (not charsets) or \"*\" in charsets or encoding in charsets:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "132", "colour": "orange", "code": "                if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "133", "colour": "orange", "code": "                    cherrypy.log('Attempting encoding %r' % encoding, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "134", "colour": "orange", "code": "                if encoder(encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "135", "colour": "orange", "code": "                    return encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "136", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "137", "colour": "orange", "code": "            if not encs:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "138", "colour": "orange", "code": "                if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "139", "colour": "orange", "code": "                    cherrypy.log('Attempting default encoding %r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "140", "colour": "orange", "code": "                                 self.default_encoding, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "141", "colour": "orange", "code": "                # Any character-set is acceptable.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "142", "colour": "orange", "code": "                if encoder(self.default_encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "143", "colour": "orange", "code": "                    return self.default_encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "144", "colour": "orange", "code": "                else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "145", "colour": "orange", "code": "                    raise cherrypy.HTTPError(500, self.failmsg % self.default_encoding)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "146", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "147", "colour": "orange", "code": "                for element in encs:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "148", "colour": "orange", "code": "                    if element.qvalue > 0:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "149", "colour": "orange", "code": "                        if element.value == \"*\":\n", "error": "none", "author": "tom@organisms.be"}, {"index": "150", "colour": "orange", "code": "                            # Matches any charset. Try our default.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "151", "colour": "orange", "code": "                            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "152", "colour": "orange", "code": "                                cherrypy.log('Attempting default encoding due '\n", "error": "none", "author": "tom@organisms.be"}, {"index": "153", "colour": "orange", "code": "                                             'to %r' % element, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "154", "colour": "orange", "code": "                            if encoder(self.default_encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "155", "colour": "orange", "code": "                                return self.default_encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "156", "colour": "orange", "code": "                        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "157", "colour": "orange", "code": "                            encoding = element.value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "158", "colour": "orange", "code": "                            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "159", "colour": "orange", "code": "                                cherrypy.log('Attempting encoding %s (qvalue >'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "160", "colour": "orange", "code": "                                             '0)' % element, 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "161", "colour": "orange", "code": "                            if encoder(encoding):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "162", "colour": "orange", "code": "                                return encoding\n", "error": "none", "author": "tom@organisms.be"}, {"index": "163", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "164", "colour": "orange", "code": "                if \"*\" not in charsets:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "165", "colour": "orange", "code": "                    # If no \"*\" is present in an Accept-Charset field, then all\n", "error": "none", "author": "tom@organisms.be"}, {"index": "166", "colour": "orange", "code": "                    # character sets not explicitly mentioned get a quality\n", "error": "none", "author": "tom@organisms.be"}, {"index": "167", "colour": "orange", "code": "                    # value of 0, except for ISO-8859-1, which gets a quality\n", "error": "none", "author": "tom@organisms.be"}, {"index": "168", "colour": "orange", "code": "                    # value of 1 if not explicitly mentioned.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "169", "colour": "orange", "code": "                    iso = 'iso-8859-1'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "170", "colour": "orange", "code": "                    if iso not in charsets:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "171", "colour": "orange", "code": "                        if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "172", "colour": "orange", "code": "                            cherrypy.log('Attempting ISO-8859-1 encoding',\n", "error": "none", "author": "tom@organisms.be"}, {"index": "173", "colour": "orange", "code": "                                         'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "174", "colour": "orange", "code": "                        if encoder(iso):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "175", "colour": "orange", "code": "                            return iso\n", "error": "none", "author": "tom@organisms.be"}, {"index": "176", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "177", "colour": "orange", "code": "        # No suitable encoding found.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "178", "colour": "orange", "code": "        ac = request.headers.get('Accept-Charset')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "179", "colour": "orange", "code": "        if ac is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "180", "colour": "orange", "code": "            msg = \"Your client did not send an Accept-Charset header.\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "181", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "182", "colour": "orange", "code": "            msg = \"Your client sent this Accept-Charset header: %s.\" % ac\n", "error": "none", "author": "tom@organisms.be"}, {"index": "183", "colour": "orange", "code": "        msg += \" We tried these charsets: %s.\" % \", \".join(self.attempted_charsets)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "184", "colour": "orange", "code": "        raise cherrypy.HTTPError(406, msg)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "185", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "186", "colour": "blue", "code": "    def __call__(self, *args, **kwargs):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "187", "colour": "orange", "code": "        response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "188", "colour": "green", "code": "        self.body = self.oldhandler(*args, **kwargs)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "189", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "190", "colour": "orange", "code": "        if isinstance(self.body, basestring):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "191", "colour": "orange", "code": "            # strings get wrapped in a list because iterating over a single\n", "error": "none", "author": "tom@organisms.be"}, {"index": "192", "colour": "orange", "code": "            # item list is much faster than iterating over every character\n", "error": "none", "author": "tom@organisms.be"}, {"index": "193", "colour": "orange", "code": "            # in a long string.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "194", "colour": "orange", "code": "            if self.body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "195", "colour": "green", "code": "                self.body = [self.body]\n", "error": "W", "author": "tom@organisms.be"}, {"index": "196", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "197", "colour": "orange", "code": "                # [''] doesn't evaluate to False, so replace it with [].\n", "error": "none", "author": "tom@organisms.be"}, {"index": "198", "colour": "green", "code": "                self.body = []\n", "error": "W", "author": "tom@organisms.be"}, {"index": "199", "colour": "orange", "code": "        elif hasattr(self.body, 'read'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "200", "colour": "green", "code": "            self.body = file_generator(self.body)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "201", "colour": "orange", "code": "        elif self.body is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "202", "colour": "green", "code": "            self.body = []\n", "error": "W", "author": "tom@organisms.be"}, {"index": "203", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "204", "colour": "orange", "code": "        ct = response.headers.elements(\"Content-Type\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "205", "colour": "orange", "code": "        if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "206", "colour": "orange", "code": "            cherrypy.log('Content-Type: %r' % [str(h) for h in ct], 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "207", "colour": "orange", "code": "        if ct:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "208", "colour": "orange", "code": "            ct = ct[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "209", "colour": "orange", "code": "            if self.text_only:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "210", "colour": "orange", "code": "                if ct.value.lower().startswith(\"text/\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "211", "colour": "orange", "code": "                    if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "212", "colour": "orange", "code": "                        cherrypy.log('Content-Type %s starts with \"text/\"' % ct,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "213", "colour": "orange", "code": "                                     'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "214", "colour": "orange", "code": "                    do_find = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "215", "colour": "orange", "code": "                else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "216", "colour": "orange", "code": "                    if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "217", "colour": "orange", "code": "                        cherrypy.log('Not finding because Content-Type %s does '\n", "error": "none", "author": "tom@organisms.be"}, {"index": "218", "colour": "orange", "code": "                                     'not start with \"text/\"' % ct,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "219", "colour": "orange", "code": "                                     'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "220", "colour": "orange", "code": "                    do_find = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "221", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "222", "colour": "orange", "code": "                if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "223", "colour": "orange", "code": "                    cherrypy.log('Finding because not text_only', 'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "224", "colour": "orange", "code": "                do_find = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "225", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "226", "colour": "orange", "code": "            if do_find:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "227", "colour": "orange", "code": "                # Set \"charset=...\" param on response Content-Type header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "228", "colour": "orange", "code": "                ct.params['charset'] = self.find_acceptable_charset()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "229", "colour": "orange", "code": "                if self.add_charset:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "230", "colour": "orange", "code": "                    if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "231", "colour": "orange", "code": "                        cherrypy.log('Setting Content-Type %s' % ct,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "232", "colour": "orange", "code": "                                     'TOOLS.ENCODE')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "233", "colour": "orange", "code": "                    response.headers[\"Content-Type\"] = str(ct)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "234", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "235", "colour": "orange", "code": "        return self.body\n", "error": "none", "author": "tom@organisms.be"}, {"index": "236", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "237", "colour": "orange", "code": "# GZIP\n", "error": "none", "author": "tom@organisms.be"}, {"index": "238", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "239", "colour": "orange", "code": "def compress(body, compress_level):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "240", "colour": "orange", "code": "    \"\"\"Compress 'body' at the given compress_level.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "241", "colour": "orange", "code": "    import zlib\n", "error": "none", "author": "tom@organisms.be"}, {"index": "242", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "243", "colour": "orange", "code": "    # See http://www.gzip.org/zlib/rfc-gzip.html\n", "error": "none", "author": "tom@organisms.be"}, {"index": "244", "colour": "orange", "code": "    yield ntob('\\x1f\\x8b')       # ID1 and ID2: gzip marker\n", "error": "none", "author": "tom@organisms.be"}, {"index": "245", "colour": "orange", "code": "    yield ntob('\\x08')           # CM: compression method\n", "error": "none", "author": "tom@organisms.be"}, {"index": "246", "colour": "orange", "code": "    yield ntob('\\x00')           # FLG: none set\n", "error": "none", "author": "tom@organisms.be"}, {"index": "247", "colour": "orange", "code": "    # MTIME: 4 bytes\n", "error": "none", "author": "tom@organisms.be"}, {"index": "248", "colour": "orange", "code": "    yield struct.pack(\"<L\", int(time.time()) & int('FFFFFFFF', 16))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "249", "colour": "orange", "code": "    yield ntob('\\x02')           # XFL: max compression, slowest algo\n", "error": "none", "author": "tom@organisms.be"}, {"index": "250", "colour": "orange", "code": "    yield ntob('\\xff')           # OS: unknown\n", "error": "none", "author": "tom@organisms.be"}, {"index": "251", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "252", "colour": "orange", "code": "    crc = zlib.crc32(ntob(\"\"))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "253", "colour": "orange", "code": "    size = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "254", "colour": "orange", "code": "    zobj = zlib.compressobj(compress_level,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "255", "colour": "orange", "code": "                            zlib.DEFLATED, -zlib.MAX_WBITS,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "256", "colour": "orange", "code": "                            zlib.DEF_MEM_LEVEL, 0)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "257", "colour": "orange", "code": "    for line in body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "258", "colour": "orange", "code": "        size += len(line)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "259", "colour": "orange", "code": "        crc = zlib.crc32(line, crc)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "260", "colour": "orange", "code": "        yield zobj.compress(line)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "261", "colour": "orange", "code": "    yield zobj.flush()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "262", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "263", "colour": "orange", "code": "    # CRC32: 4 bytes\n", "error": "none", "author": "tom@organisms.be"}, {"index": "264", "colour": "orange", "code": "    yield struct.pack(\"<L\", crc & int('FFFFFFFF', 16))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "265", "colour": "orange", "code": "    # ISIZE: 4 bytes\n", "error": "none", "author": "tom@organisms.be"}, {"index": "266", "colour": "orange", "code": "    yield struct.pack(\"<L\", size & int('FFFFFFFF', 16))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "267", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "268", "colour": "orange", "code": "def decompress(body):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "269", "colour": "green", "code": "    import gzip\n", "error": "W", "author": "tom@organisms.be"}, {"index": "270", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "271", "colour": "orange", "code": "    zbuf = BytesIO()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "272", "colour": "orange", "code": "    zbuf.write(body)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "273", "colour": "orange", "code": "    zbuf.seek(0)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "274", "colour": "orange", "code": "    zfile = gzip.GzipFile(mode='rb', fileobj=zbuf)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "275", "colour": "orange", "code": "    data = zfile.read()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "276", "colour": "orange", "code": "    zfile.close()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "277", "colour": "orange", "code": "    return data\n", "error": "none", "author": "tom@organisms.be"}, {"index": "278", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "279", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "280", "colour": "blue", "code": "def gzip(compress_level=5, mime_types=['text/html', 'text/plain'], debug=False):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "281", "colour": "orange", "code": "    \"\"\"Try to gzip the response body if Content-Type in mime_types.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "282", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "283", "colour": "orange", "code": "    cherrypy.response.headers['Content-Type'] must be set to one of the\n", "error": "none", "author": "tom@organisms.be"}, {"index": "284", "colour": "orange", "code": "    values in the mime_types arg before calling this function.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "285", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "286", "colour": "orange", "code": "    The provided list of mime-types must be of one of the following form:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "287", "colour": "orange", "code": "        * type/subtype\n", "error": "none", "author": "tom@organisms.be"}, {"index": "288", "colour": "orange", "code": "        * type/*\n", "error": "none", "author": "tom@organisms.be"}, {"index": "289", "colour": "orange", "code": "        * type/*+subtype\n", "error": "none", "author": "tom@organisms.be"}, {"index": "290", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "291", "colour": "orange", "code": "    No compression is performed if any of the following hold:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "292", "colour": "orange", "code": "        * The client sends no Accept-Encoding request header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "293", "colour": "orange", "code": "        * No 'gzip' or 'x-gzip' is present in the Accept-Encoding header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "294", "colour": "orange", "code": "        * No 'gzip' or 'x-gzip' with a qvalue > 0 is present\n", "error": "none", "author": "tom@organisms.be"}, {"index": "295", "colour": "orange", "code": "        * The 'identity' value is given with a qvalue > 0.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "296", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "297", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "298", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "299", "colour": "orange", "code": "    response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "300", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "301", "colour": "orange", "code": "    set_vary_header(response, \"Accept-Encoding\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "302", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "303", "colour": "orange", "code": "    if not response.body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "304", "colour": "orange", "code": "        # Response body is empty (might be a 304 for instance)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "305", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "306", "colour": "orange", "code": "            cherrypy.log('No response body', context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "307", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "308", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "309", "colour": "orange", "code": "    # If returning cached content (which should already have been gzipped),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "310", "colour": "orange", "code": "    # don't re-zip.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "311", "colour": "orange", "code": "    if getattr(request, \"cached\", False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "312", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "313", "colour": "orange", "code": "            cherrypy.log('Not gzipping cached response', context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "314", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "315", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "316", "colour": "orange", "code": "    acceptable = request.headers.elements('Accept-Encoding')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "317", "colour": "orange", "code": "    if not acceptable:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "318", "colour": "orange", "code": "        # If no Accept-Encoding field is present in a request,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "319", "colour": "orange", "code": "        # the server MAY assume that the client will accept any\n", "error": "none", "author": "tom@organisms.be"}, {"index": "320", "colour": "orange", "code": "        # content coding. In this case, if \"identity\" is one of\n", "error": "none", "author": "tom@organisms.be"}, {"index": "321", "colour": "orange", "code": "        # the available content-codings, then the server SHOULD use\n", "error": "none", "author": "tom@organisms.be"}, {"index": "322", "colour": "orange", "code": "        # the \"identity\" content-coding, unless it has additional\n", "error": "none", "author": "tom@organisms.be"}, {"index": "323", "colour": "orange", "code": "        # information that a different content-coding is meaningful\n", "error": "none", "author": "tom@organisms.be"}, {"index": "324", "colour": "orange", "code": "        # to the client.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "325", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "326", "colour": "orange", "code": "            cherrypy.log('No Accept-Encoding', context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "327", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "328", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "329", "colour": "orange", "code": "    ct = response.headers.get('Content-Type', '').split(';')[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "330", "colour": "orange", "code": "    for coding in acceptable:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "331", "colour": "orange", "code": "        if coding.value == 'identity' and coding.qvalue != 0:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "332", "colour": "orange", "code": "            if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "333", "colour": "orange", "code": "                cherrypy.log('Non-zero identity qvalue: %s' % coding,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "334", "colour": "orange", "code": "                             context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "335", "colour": "orange", "code": "            return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "336", "colour": "orange", "code": "        if coding.value in ('gzip', 'x-gzip'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "337", "colour": "orange", "code": "            if coding.qvalue == 0:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "338", "colour": "orange", "code": "                if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "339", "colour": "orange", "code": "                    cherrypy.log('Zero gzip qvalue: %s' % coding,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "340", "colour": "orange", "code": "                                 context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "341", "colour": "orange", "code": "                return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "342", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "343", "colour": "orange", "code": "            if ct not in mime_types:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "344", "colour": "orange", "code": "                # If the list of provided mime-types contains tokens\n", "error": "none", "author": "tom@organisms.be"}, {"index": "345", "colour": "orange", "code": "                # such as 'text/*' or 'application/*+xml',\n", "error": "none", "author": "tom@organisms.be"}, {"index": "346", "colour": "orange", "code": "                # we go through them and find the most appropriate one\n", "error": "none", "author": "tom@organisms.be"}, {"index": "347", "colour": "orange", "code": "                # based on the given content-type.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "348", "colour": "orange", "code": "                # The pattern matching is only caring about the most\n", "error": "none", "author": "tom@organisms.be"}, {"index": "349", "colour": "orange", "code": "                # common cases, as stated above, and doesn't support\n", "error": "none", "author": "tom@organisms.be"}, {"index": "350", "colour": "orange", "code": "                # for extra parameters.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "351", "colour": "orange", "code": "                found = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "352", "colour": "orange", "code": "                if '/' in ct:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "353", "colour": "orange", "code": "                    ct_media_type, ct_sub_type = ct.split('/')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "354", "colour": "orange", "code": "                    for mime_type in mime_types:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "355", "colour": "orange", "code": "                        if '/' in mime_type:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "356", "colour": "orange", "code": "                            media_type, sub_type = mime_type.split('/')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "357", "colour": "orange", "code": "                            if ct_media_type == media_type:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "358", "colour": "orange", "code": "                                if sub_type == '*':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "359", "colour": "orange", "code": "                                    found = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "360", "colour": "orange", "code": "                                    break\n", "error": "none", "author": "tom@organisms.be"}, {"index": "361", "colour": "orange", "code": "                                elif '+' in sub_type and '+' in ct_sub_type:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "362", "colour": "green", "code": "                                    ct_left, ct_right = ct_sub_type.split('+')\n", "error": "W", "author": "tom@organisms.be"}, {"index": "363", "colour": "orange", "code": "                                    left, right = sub_type.split('+')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "364", "colour": "orange", "code": "                                    if left == '*' and ct_right == right:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "365", "colour": "orange", "code": "                                        found = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "366", "colour": "orange", "code": "                                        break\n", "error": "none", "author": "tom@organisms.be"}, {"index": "367", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "368", "colour": "orange", "code": "                if not found:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "369", "colour": "orange", "code": "                    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "370", "colour": "orange", "code": "                        cherrypy.log('Content-Type %s not in mime_types %r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "371", "colour": "orange", "code": "                                     (ct, mime_types), context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "372", "colour": "orange", "code": "                    return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "373", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "374", "colour": "orange", "code": "            if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "375", "colour": "orange", "code": "                cherrypy.log('Gzipping', context='TOOLS.GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "376", "colour": "orange", "code": "            # Return a generator that compresses the page\n", "error": "none", "author": "tom@organisms.be"}, {"index": "377", "colour": "orange", "code": "            response.headers['Content-Encoding'] = 'gzip'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "378", "colour": "orange", "code": "            response.body = compress(response.body, compress_level)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "379", "colour": "orange", "code": "            if \"Content-Length\" in response.headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "380", "colour": "orange", "code": "                # Delete Content-Length header so finalize() recalcs it.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "381", "colour": "orange", "code": "                del response.headers[\"Content-Length\"]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "382", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "383", "colour": "orange", "code": "            return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "384", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "385", "colour": "orange", "code": "    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "386", "colour": "orange", "code": "        cherrypy.log('No acceptable encoding found.', context='GZIP')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "387", "colour": "orange", "code": "    cherrypy.HTTPError(406, \"identity, gzip\").set_response()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "388", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}]}