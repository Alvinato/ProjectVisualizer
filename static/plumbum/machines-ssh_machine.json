{"path": "/home/asumal/git/cs410/plumbum/plumbum/machines/ssh_machine.py", "lines": [{"index": "1", "colour": "orange", "code": "from __future__ import with_statement\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "2", "colour": "orange", "code": "from plumbum.lib import _setdoc, IS_WIN32\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "3", "colour": "orange", "code": "from plumbum.machines.remote import BaseRemoteMachine\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "4", "colour": "orange", "code": "from plumbum.machines.session import ShellSession\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "5", "colour": "orange", "code": "from plumbum.machines.local import local\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "6", "colour": "orange", "code": "from plumbum.path.local import LocalPath\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "7", "colour": "orange", "code": "from plumbum.path.remote import RemotePath\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "8", "colour": "orange", "code": "from plumbum.commands import ProcessExecutionError, shquote\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "9", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "10", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "11", "colour": "blue", "code": "class SshTunnel(object):\n", "error": "R", "author": "Tomer.Filiba@emc.com"}, {"index": "12", "colour": "orange", "code": "    \"\"\"An object representing an SSH tunnel (created by\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "13", "colour": "orange", "code": "    :func:`SshMachine.tunnel <plumbum.machines.remote.SshMachine.tunnel>`)\"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "14", "colour": "orange", "code": "    __slots__ = [\"_session\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "15", "colour": "orange", "code": "    def __init__(self, session):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "16", "colour": "orange", "code": "        self._session = session\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "17", "colour": "orange", "code": "    def __repr__(self):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "18", "colour": "orange", "code": "        if self._session.alive():\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "19", "colour": "orange", "code": "            return \"<SshTunnel %s>\" % (self._session.proc,)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "20", "colour": "orange", "code": "        else:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "21", "colour": "orange", "code": "            return \"<SshTunnel (defunct)>\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "22", "colour": "orange", "code": "    def __enter__(self):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "23", "colour": "orange", "code": "        return self\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "24", "colour": "orange", "code": "    def __exit__(self, t, v, tb):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "25", "colour": "orange", "code": "        self.close()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "26", "colour": "orange", "code": "    def close(self):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "27", "colour": "orange", "code": "        \"\"\"Closes(terminates) the tunnel\"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "28", "colour": "orange", "code": "        self._session.close()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "29", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "30", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "31", "colour": "orange", "code": "class SshMachine(BaseRemoteMachine):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "32", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "33", "colour": "orange", "code": "    An implementation of :class:`remote machine <plumbum.machines.remote.BaseRemoteMachine>`\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "34", "colour": "orange", "code": "    over SSH. Invoking a remote command translates to invoking it over SSH ::\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "35", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "36", "colour": "orange", "code": "        with SshMachine(\"yourhostname\") as rem:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "37", "colour": "orange", "code": "            r_ls = rem[\"ls\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "38", "colour": "orange", "code": "            # r_ls is the remote `ls`\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "39", "colour": "orange", "code": "            # executing r_ls() translates to `ssh yourhostname ls`\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "40", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "41", "colour": "orange", "code": "    :param host: the host name to connect to (SSH server)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "42", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "43", "colour": "orange", "code": "    :param user: the user to connect as (if ``None``, the default will be used)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "44", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "45", "colour": "orange", "code": "    :param port: the server's port (if ``None``, the default will be used)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "46", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "47", "colour": "orange", "code": "    :param keyfile: the path to the identity file (if ``None``, the default will be used)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "48", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "49", "colour": "orange", "code": "    :param ssh_command: the ``ssh`` command to use; this has to be a ``Command`` object;\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "50", "colour": "orange", "code": "                        if ``None``, the default ssh client will be used.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "51", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "52", "colour": "orange", "code": "    :param scp_command: the ``scp`` command to use; this has to be a ``Command`` object;\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "53", "colour": "orange", "code": "                        if ``None``, the default scp program will be used.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "54", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "55", "colour": "orange", "code": "    :param ssh_opts: any additional options for ``ssh`` (a list of strings)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "56", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "57", "colour": "orange", "code": "    :param scp_opts: any additional options for ``scp`` (a list of strings)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "58", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "59", "colour": "orange", "code": "    :param password: the password to use; requires ``sshpass`` be installed. Cannot be used\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "60", "colour": "orange", "code": "                     in conjunction with ``ssh_command`` or ``scp_command`` (will be ignored).\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "61", "colour": "orange", "code": "                     NOTE: THIS IS A SECURITY RISK!\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "62", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "63", "colour": "orange", "code": "    :param encoding: the remote machine's encoding (defaults to UTF8)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "64", "colour": "orange", "code": "    \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "65", "colour": "orange", "code": "    :param connect_timeout: specify a connection timeout (the time until shell prompt is seen).\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "66", "colour": "orange", "code": "                            The default is 10 seconds. Set to ``None`` to disable\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "67", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "68", "colour": "orange", "code": "    :param new_session: whether or not to start the background session as a new\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "69", "colour": "orange", "code": "                        session leader (setsid). This will prevent it from being killed on\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "70", "colour": "orange", "code": "                        Ctrl+C (SIGINT)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "71", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "72", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "73", "colour": "blue", "code": "    def __init__(self, host, user = None, port = None, keyfile = None, ssh_command = None,\n", "error": "R", "author": "Tomer.Filiba@emc.com"}, {"index": "74", "colour": "orange", "code": "            scp_command = None, ssh_opts = (), scp_opts = (), password = None, encoding = \"utf8\",\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "75", "colour": "orange", "code": "            connect_timeout = 10, new_session = False):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "76", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "77", "colour": "orange", "code": "        if ssh_command is None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "78", "colour": "orange", "code": "            if password is not None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "79", "colour": "orange", "code": "                ssh_command = local[\"sshpass\"][\"-p\", password, \"ssh\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "80", "colour": "orange", "code": "            else:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "81", "colour": "orange", "code": "                ssh_command = local[\"ssh\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "82", "colour": "orange", "code": "        if scp_command is None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "83", "colour": "orange", "code": "            if password is not None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "84", "colour": "orange", "code": "                scp_command = local[\"sshpass\"][\"-p\", password, \"scp\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "85", "colour": "orange", "code": "            else:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "86", "colour": "orange", "code": "                scp_command = local[\"scp\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "87", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "88", "colour": "orange", "code": "        scp_args = []\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "89", "colour": "orange", "code": "        ssh_args = []\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "90", "colour": "orange", "code": "        if user:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "91", "colour": "orange", "code": "            self._fqhost = \"%s@%s\" % (user, host)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "92", "colour": "orange", "code": "        else:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "93", "colour": "orange", "code": "            self._fqhost = host\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "94", "colour": "orange", "code": "        if port:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "95", "colour": "orange", "code": "            ssh_args.extend([\"-p\", str(port)])\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "96", "colour": "orange", "code": "            scp_args.extend([\"-P\", str(port)])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "97", "colour": "orange", "code": "        if keyfile:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "98", "colour": "orange", "code": "            ssh_args.extend([\"-i\", str(keyfile)])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "99", "colour": "orange", "code": "            scp_args.extend([\"-i\", str(keyfile)])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "100", "colour": "orange", "code": "        scp_args.append(\"-r\")\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "101", "colour": "orange", "code": "        ssh_args.extend(ssh_opts)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "102", "colour": "orange", "code": "        scp_args.extend(scp_opts)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "103", "colour": "orange", "code": "        self._ssh_command = ssh_command[tuple(ssh_args)]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "104", "colour": "orange", "code": "        self._scp_command = scp_command[tuple(scp_args)]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "105", "colour": "orange", "code": "        BaseRemoteMachine.__init__(self, encoding = encoding, connect_timeout = connect_timeout,\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "106", "colour": "orange", "code": "            new_session = new_session)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "107", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "108", "colour": "orange", "code": "    def __str__(self):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "109", "colour": "orange", "code": "        return \"ssh://%s\" % (self._fqhost,)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "110", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "111", "colour": "orange", "code": "    @_setdoc(BaseRemoteMachine)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "112", "colour": "orange", "code": "    def popen(self, args, ssh_opts = (), **kwargs):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "113", "colour": "orange", "code": "        cmdline = []\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "114", "colour": "orange", "code": "        cmdline.extend(ssh_opts)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "115", "colour": "orange", "code": "        cmdline.append(self._fqhost)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "116", "colour": "orange", "code": "        if args and hasattr(self, \"env\"):\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "117", "colour": "orange", "code": "            envdelta = self.env.getdelta()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "118", "colour": "orange", "code": "            cmdline.extend([\"cd\", str(self.cwd), \"&&\"])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "119", "colour": "orange", "code": "            if envdelta:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "120", "colour": "orange", "code": "                cmdline.append(\"env\")\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "121", "colour": "orange", "code": "                cmdline.extend(\"%s=%s\" % (k, v) for k, v in envdelta.items())\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "122", "colour": "orange", "code": "            if isinstance(args, (tuple, list)):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "123", "colour": "orange", "code": "                cmdline.extend(args)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "124", "colour": "orange", "code": "            else:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "125", "colour": "orange", "code": "                cmdline.append(args)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "126", "colour": "orange", "code": "        return self._ssh_command[tuple(cmdline)].popen(**kwargs)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "127", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "128", "colour": "orange", "code": "    def nohup(self, command):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "129", "colour": "orange", "code": "        \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "130", "colour": "orange", "code": "        Runs the given command using ``nohup`` and redirects std handles to ``/dev/null``,\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "131", "colour": "orange", "code": "        allowing the command to run \"detached\" from its controlling TTY or parent.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "132", "colour": "orange", "code": "        Does not return anything.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "133", "colour": "orange", "code": "        \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "134", "colour": "orange", "code": "        args = [\"nohup\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "135", "colour": "orange", "code": "        args.extend(command.formulate())\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "136", "colour": "orange", "code": "        args.extend([\">/dev/null\", \"2>/dev/null\", \"</dev/null\"])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "137", "colour": "orange", "code": "        proc = self.popen(args, ssh_opts = [\"-f\"])\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "138", "colour": "orange", "code": "        rc = proc.wait()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "139", "colour": "orange", "code": "        try:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "140", "colour": "orange", "code": "            if rc != 0:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "141", "colour": "orange", "code": "                raise ProcessExecutionError(args, rc, proc.stdout.read(), proc.stderr.read())\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "142", "colour": "orange", "code": "        finally:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "143", "colour": "orange", "code": "            proc.stdin.close()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "144", "colour": "orange", "code": "            proc.stdout.close()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "145", "colour": "orange", "code": "            proc.stderr.close()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "146", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "147", "colour": "orange", "code": "    @_setdoc(BaseRemoteMachine)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "148", "colour": "orange", "code": "    def session(self, isatty = False, new_session = False):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "149", "colour": "orange", "code": "        return ShellSession(self.popen([\"/bin/sh\"], ([\"-tt\"] if isatty else [\"-T\"]), new_session = new_session),\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "150", "colour": "orange", "code": "            self.encoding, isatty, self.connect_timeout)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "151", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "152", "colour": "green", "code": "    def tunnel(self, lport, dport, lhost = \"localhost\", dhost = \"localhost\", connect_timeout = 5):\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "153", "colour": "orange", "code": "        r\"\"\"Creates an SSH tunnel from the TCP port (``lport``) of the local machine\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "154", "colour": "orange", "code": "        (``lhost``, defaults to ``\"localhost\"``, but it can be any IP you can ``bind()``)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "155", "colour": "orange", "code": "        to the remote TCP port (``dport``) of the destination machine (``dhost``, defaults\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "156", "colour": "orange", "code": "        to ``\"localhost\"``, which means *this remote machine*). The returned\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "157", "colour": "orange", "code": "        :class:`SshTunnel <plumbum.machines.remote.SshTunnel>` object can be used as a\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "158", "colour": "orange", "code": "        *context-manager*.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "159", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "160", "colour": "orange", "code": "        The more conventional use case is the following::\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "161", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "162", "colour": "orange", "code": "            +---------+          +---------+\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "163", "colour": "orange", "code": "            | Your    |          | Remote  |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "164", "colour": "orange", "code": "            | Machine |          | Machine |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "165", "colour": "orange", "code": "            +----o----+          +---- ----+\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "166", "colour": "orange", "code": "                 |                    ^\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "167", "colour": "orange", "code": "                 |                    |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "168", "colour": "orange", "code": "               lport                dport\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "169", "colour": "orange", "code": "                 |                    |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "170", "colour": "orange", "code": "                 \\______SSH TUNNEL____/\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "171", "colour": "orange", "code": "                        (secure)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "172", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "173", "colour": "orange", "code": "        Here, you wish to communicate safely between port ``lport`` of your machine and\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "174", "colour": "orange", "code": "        port ``dport`` of the remote machine. Communication is tunneled over SSH, so the\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "175", "colour": "orange", "code": "        connection is authenticated and encrypted.\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "176", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "177", "colour": "orange", "code": "        The more general case is shown below (where ``dport != \"localhost\"``)::\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "178", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "179", "colour": "orange", "code": "            +---------+          +-------------+      +-------------+\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "180", "colour": "orange", "code": "            | Your    |          | Remote      |      | Destination |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "181", "colour": "orange", "code": "            | Machine |          | Machine     |      | Machine     |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "182", "colour": "orange", "code": "            +----o----+          +---- ----o---+      +---- --------+\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "183", "colour": "orange", "code": "                 |                    ^    |               ^\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "184", "colour": "orange", "code": "                 |                    |    |               |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "185", "colour": "orange", "code": "            lhost:lport               |    |          dhost:dport\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "186", "colour": "orange", "code": "                 |                    |    |               |\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "187", "colour": "orange", "code": "                 \\_____SSH TUNNEL_____/    \\_____SOCKET____/\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "188", "colour": "orange", "code": "                        (secure)              (not secure)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "189", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "190", "colour": "orange", "code": "        Usage::\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "191", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "192", "colour": "orange", "code": "            rem = SshMachine(\"megazord\")\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "193", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "194", "colour": "orange", "code": "            with rem.tunnel(1234, 5678):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "195", "colour": "orange", "code": "                sock = socket.socket()\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "196", "colour": "orange", "code": "                sock.connect((\"localhost\", 1234))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "197", "colour": "orange", "code": "                # sock is now tunneled to megazord:5678\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "198", "colour": "orange", "code": "        \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "199", "colour": "orange", "code": "        ssh_opts = [\"-L\", \"[%s]:%s:[%s]:%s\" % (lhost, lport, dhost, dport)]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "200", "colour": "orange", "code": "        proc = self.popen((), ssh_opts = ssh_opts, new_session = True)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "201", "colour": "orange", "code": "        return SshTunnel(ShellSession(proc, self.encoding, connect_timeout = self.connect_timeout))\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "202", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "203", "colour": "blue", "code": "    def _translate_drive_letter(self, path):\n", "error": "R", "author": "Tomer.Filiba@emc.com"}, {"index": "204", "colour": "orange", "code": "        # replace c:\\some\\path with /c/some/path\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "205", "colour": "orange", "code": "        path = str(path)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "206", "colour": "orange", "code": "        if \":\" in path:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "207", "colour": "orange", "code": "            path = \"/\" + path.replace(\":\", \"\").replace(\"\\\\\", \"/\")\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "208", "colour": "orange", "code": "        return path\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "209", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "210", "colour": "orange", "code": "    @_setdoc(BaseRemoteMachine)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "211", "colour": "orange", "code": "    def download(self, src, dst):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "212", "colour": "orange", "code": "        if isinstance(src, LocalPath):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "213", "colour": "orange", "code": "            raise TypeError(\"src of download cannot be %r\" % (src,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "214", "colour": "orange", "code": "        if isinstance(src, RemotePath) and src.remote != self:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "215", "colour": "orange", "code": "            raise TypeError(\"src %r points to a different remote machine\" % (src,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "216", "colour": "orange", "code": "        if isinstance(dst, RemotePath):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "217", "colour": "orange", "code": "            raise TypeError(\"dst of download cannot be %r\" % (dst,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "218", "colour": "orange", "code": "        if IS_WIN32:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "219", "colour": "orange", "code": "            src = self._translate_drive_letter(src)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "220", "colour": "orange", "code": "            dst = self._translate_drive_letter(dst)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "221", "colour": "orange", "code": "        self._scp_command(\"%s:%s\" % (self._fqhost, shquote(src)), dst)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "222", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "223", "colour": "orange", "code": "    @_setdoc(BaseRemoteMachine)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "224", "colour": "orange", "code": "    def upload(self, src, dst):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "225", "colour": "orange", "code": "        if isinstance(src, RemotePath):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "226", "colour": "orange", "code": "            raise TypeError(\"src of upload cannot be %r\" % (src,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "227", "colour": "orange", "code": "        if isinstance(dst, LocalPath):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "228", "colour": "orange", "code": "            raise TypeError(\"dst of upload cannot be %r\" % (dst,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "229", "colour": "orange", "code": "        if isinstance(dst, RemotePath) and dst.remote != self:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "230", "colour": "orange", "code": "            raise TypeError(\"dst %r points to a different remote machine\" % (dst,))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "231", "colour": "orange", "code": "        if IS_WIN32:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "232", "colour": "orange", "code": "            src = self._translate_drive_letter(src)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "233", "colour": "orange", "code": "            dst = self._translate_drive_letter(dst)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "234", "colour": "orange", "code": "        self._scp_command(src, \"%s:%s\" % (self._fqhost, shquote(dst)))\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "235", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "236", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "237", "colour": "orange", "code": "class PuttyMachine(SshMachine):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "238", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "239", "colour": "orange", "code": "    PuTTY-flavored SSH connection. The programs ``plink`` and ``pscp`` are expected to\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "240", "colour": "orange", "code": "    be in the path (or you may provide your own ``ssh_command`` and ``scp_command``)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "241", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "242", "colour": "orange", "code": "    Arguments are the same as for :class:`plumbum.machines.remote.SshMachine`\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "243", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "244", "colour": "blue", "code": "    def __init__(self, host, user = None, port = None, keyfile = None, ssh_command = None,\n", "error": "R", "author": "Tomer.Filiba@emc.com"}, {"index": "245", "colour": "orange", "code": "            scp_command = None, ssh_opts = (), scp_opts = (), encoding = \"utf8\",\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "246", "colour": "orange", "code": "            connect_timeout = 10, new_session = False):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "247", "colour": "orange", "code": "        if ssh_command is None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "248", "colour": "orange", "code": "            ssh_command = local[\"plink\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "249", "colour": "orange", "code": "        if scp_command is None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "250", "colour": "orange", "code": "            scp_command = local[\"pscp\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "251", "colour": "orange", "code": "        if not ssh_opts:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "252", "colour": "orange", "code": "            ssh_opts = [\"-ssh\"]\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "253", "colour": "orange", "code": "        if user is None:\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "254", "colour": "orange", "code": "            user = local.env.user\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "255", "colour": "orange", "code": "        if port is not None:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "256", "colour": "orange", "code": "            ssh_opts.extend([\"-P\", str(port)])\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "257", "colour": "orange", "code": "            port = None\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "258", "colour": "orange", "code": "        SshMachine.__init__(self, host, user, port, keyfile = keyfile, ssh_command = ssh_command,\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "259", "colour": "orange", "code": "            scp_command = scp_command, ssh_opts = ssh_opts, scp_opts = scp_opts, encoding = encoding,\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "260", "colour": "orange", "code": "            connect_timeout = connect_timeout, new_session = new_session)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "261", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "262", "colour": "orange", "code": "    def __str__(self):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "263", "colour": "orange", "code": "        return \"putty-ssh://%s\" % (self._fqhost,)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "264", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "265", "colour": "orange", "code": "    def _translate_drive_letter(self, path):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "266", "colour": "orange", "code": "        # pscp takes care of windows paths automatically\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "267", "colour": "orange", "code": "        return path\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "268", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "269", "colour": "orange", "code": "    @_setdoc(BaseRemoteMachine)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "270", "colour": "orange", "code": "    def session(self, isatty = False, new_session = False):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "271", "colour": "orange", "code": "        return ShellSession(self.popen((), ([\"-t\"] if isatty else [\"-T\"]), new_session = new_session),\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "272", "colour": "orange", "code": "            self.encoding, isatty, self.connect_timeout)\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "273", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "274", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}]}