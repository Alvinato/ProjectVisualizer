{"path": "/home/asumal/git/cs410/plumbum/plumbum/commands/daemons.py", "lines": [[{"error": "C", "line": "1", "code": "import subprocess\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "2", "code": "import os\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "3", "code": "import time\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "4", "code": "import sys\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "5", "code": "import errno\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "6", "code": "import signal\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "7", "code": "import traceback\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "8", "code": "from plumbum.commands.processes import ProcessExecutionError\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}, {"error": "none", "line": "9", "code": "\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "10", "code": "\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "R", "line": "11", "code": "def posix_daemonize(command, cwd):\n", "colour": "green", "author": "Tomer.Filiba@emc.com"}, {"error": "C", "line": "12", "code": "    MAX_SIZE = 16384\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "13", "code": "    rfd, wfd = os.pipe()\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "14", "code": "    argv = command.formulate()\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "15", "code": "    firstpid = os.fork()\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "16", "code": "    if firstpid == 0:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "17", "code": "        # first child: become session leader,\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "18", "code": "        os.close(rfd)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "19", "code": "        rc = 0\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "20", "code": "        try:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "21", "code": "            os.setsid()\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "22", "code": "            os.umask(0)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "23", "code": "            stdin = open(os.devnull, \"r\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "24", "code": "            stdout = open(os.devnull, \"w\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "25", "code": "            stderr = open(os.devnull, \"w\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "26", "code": "            signal.signal(signal.SIGHUP, signal.SIG_IGN)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "27", "code": "            proc = command.popen(cwd = cwd, close_fds = True, stdin = stdin.fileno(), \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "28", "code": "                stdout = stdout.fileno(), stderr = stderr.fileno())\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "29", "code": "            os.write(wfd, str(proc.pid).encode(\"utf8\"))\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "W", "line": "30", "code": "        except:\n", "colour": "purple", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "31", "code": "            rc = 1\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "32", "code": "            tbtext = \"\".join(traceback.format_exception(*sys.exc_info()))[-MAX_SIZE:]\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "33", "code": "            os.write(wfd, tbtext.encode(\"utf8\"))\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "34", "code": "        finally:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "35", "code": "            os.close(wfd)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "W", "line": "36", "code": "            os._exit(rc)\n", "colour": "purple", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "37", "code": "    else:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "38", "code": "        # wait for first child to die\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "39", "code": "        os.close(wfd)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "40", "code": "        _, rc = os.waitpid(firstpid, 0)\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "41", "code": "        output = os.read(rfd, MAX_SIZE)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "42", "code": "        try:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "43", "code": "            output = output.decode(\"utf8\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "44", "code": "        except UnicodeError:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "45", "code": "            pass\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "46", "code": "        if rc == 0 and output.isdigit():\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "47", "code": "            secondpid = int(output)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "48", "code": "        else:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "49", "code": "            raise ProcessExecutionError(argv, rc, \"\", output)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "50", "code": "        proc = subprocess.Popen.__new__(subprocess.Popen)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "W", "line": "51", "code": "        proc._child_created = True\n", "colour": "purple", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "52", "code": "        proc.returncode = None\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "53", "code": "        proc.stdout = None\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "54", "code": "        proc.stdin = None\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "55", "code": "        proc.stderr = None\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "56", "code": "        proc.pid = secondpid\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "57", "code": "        proc.universal_newlines = False\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "W", "line": "58", "code": "        proc._input = None\n", "colour": "purple", "author": "tomerfiliba@gmail.com"}, {"error": "W", "line": "59", "code": "        proc._communication_started = False\n", "colour": "purple", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "60", "code": "        proc.args = argv\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "61", "code": "        proc.argv = argv\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "62", "code": "        \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "63", "code": "        def poll(self = proc):\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "64", "code": "            if self.returncode is None:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "65", "code": "                try:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "66", "code": "                    os.kill(self.pid, 0)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "67", "code": "                except OSError:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "68", "code": "                    ex = sys.exc_info()[1]\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "69", "code": "                    if ex.errno == errno.ESRCH:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "70", "code": "                        # process does not exist\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "71", "code": "                        self.returncode = 0\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "72", "code": "                    else:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "73", "code": "                        raise\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "74", "code": "            return self.returncode\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "75", "code": "        \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "76", "code": "        def wait(self = proc):\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "77", "code": "            while self.returncode is None:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "78", "code": "                if self.poll() is None:\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "79", "code": "                    time.sleep(0.5)\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "80", "code": "            return proc.returncode                \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "81", "code": "        \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "82", "code": "        proc.poll = poll\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "83", "code": "        proc.wait = wait\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "84", "code": "        return proc\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "85", "code": "\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "86", "code": "\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "87", "code": "def win32_daemonize(command, cwd):\n", "colour": "blue", "author": "Tomer.Filiba@emc.com"}, {"error": "C", "line": "88", "code": "    DETACHED_PROCESS = 0x00000008\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "89", "code": "    stdin = open(os.devnull, \"r\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "90", "code": "    stdout = open(os.devnull, \"w\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "91", "code": "    stderr = open(os.devnull, \"w\")\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "92", "code": "    return command.popen(cwd = cwd, stdin = stdin.fileno(), stdout = stdout.fileno(), stderr = stderr.fileno(), \n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "C", "line": "93", "code": "        creationflags = subprocess.CREATE_NEW_PROCESS_GROUP | DETACHED_PROCESS)\n", "colour": "blue", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "94", "code": "\n", "colour": "black", "author": "tomerfiliba@gmail.com"}, {"error": "none", "line": "95", "code": "\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}, {"error": "none", "line": "96", "code": "\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}, {"error": "none", "line": "97", "code": "\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}, {"error": "none", "line": "98", "code": "\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}, {"error": "none", "line": "99", "code": "\n", "colour": "black", "author": "Tomer.Filiba@emc.com"}]]}