{"path": "/home/asumal/git/cs410/plumbum/plumbum/commands/daemons.py", "lines": [{"index": "1", "colour": "orange", "code": "import subprocess\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "2", "colour": "orange", "code": "import os\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "3", "colour": "orange", "code": "import time\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "4", "colour": "orange", "code": "import sys\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "5", "colour": "orange", "code": "import errno\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "6", "colour": "orange", "code": "import signal\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "7", "colour": "orange", "code": "import traceback\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "8", "colour": "orange", "code": "from plumbum.commands.processes import ProcessExecutionError\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "9", "colour": "orange", "code": "\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "10", "colour": "orange", "code": "\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "11", "colour": "blue", "code": "def posix_daemonize(command, cwd):\n", "error": "R", "author": "Tomer.Filiba@emc.com"}, {"index": "12", "colour": "orange", "code": "    MAX_SIZE = 16384\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "13", "colour": "orange", "code": "    rfd, wfd = os.pipe()\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "14", "colour": "orange", "code": "    argv = command.formulate()\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "15", "colour": "orange", "code": "    firstpid = os.fork()\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "16", "colour": "orange", "code": "    if firstpid == 0:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "17", "colour": "orange", "code": "        # first child: become session leader,\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "18", "colour": "orange", "code": "        os.close(rfd)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "19", "colour": "orange", "code": "        rc = 0\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "20", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "21", "colour": "orange", "code": "            os.setsid()\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "22", "colour": "orange", "code": "            os.umask(0)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "23", "colour": "orange", "code": "            stdin = open(os.devnull, \"r\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "24", "colour": "orange", "code": "            stdout = open(os.devnull, \"w\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "25", "colour": "orange", "code": "            stderr = open(os.devnull, \"w\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "26", "colour": "orange", "code": "            signal.signal(signal.SIGHUP, signal.SIG_IGN)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "27", "colour": "orange", "code": "            proc = command.popen(cwd = cwd, close_fds = True, stdin = stdin.fileno(), \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "28", "colour": "orange", "code": "                stdout = stdout.fileno(), stderr = stderr.fileno())\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "29", "colour": "orange", "code": "            os.write(wfd, str(proc.pid).encode(\"utf8\"))\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "30", "colour": "green", "code": "        except:\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "31", "colour": "orange", "code": "            rc = 1\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "32", "colour": "orange", "code": "            tbtext = \"\".join(traceback.format_exception(*sys.exc_info()))[-MAX_SIZE:]\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "33", "colour": "orange", "code": "            os.write(wfd, tbtext.encode(\"utf8\"))\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "34", "colour": "orange", "code": "        finally:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "35", "colour": "orange", "code": "            os.close(wfd)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "36", "colour": "green", "code": "            os._exit(rc)\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "37", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "38", "colour": "orange", "code": "        # wait for first child to die\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "39", "colour": "orange", "code": "        os.close(wfd)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "40", "colour": "orange", "code": "        _, rc = os.waitpid(firstpid, 0)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "41", "colour": "orange", "code": "        output = os.read(rfd, MAX_SIZE)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "42", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "43", "colour": "orange", "code": "            output = output.decode(\"utf8\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "44", "colour": "orange", "code": "        except UnicodeError:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "45", "colour": "orange", "code": "            pass\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "46", "colour": "orange", "code": "        if rc == 0 and output.isdigit():\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "47", "colour": "orange", "code": "            secondpid = int(output)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "48", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "49", "colour": "orange", "code": "            raise ProcessExecutionError(argv, rc, \"\", output)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "50", "colour": "orange", "code": "        proc = subprocess.Popen.__new__(subprocess.Popen)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "51", "colour": "green", "code": "        proc._child_created = True\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "52", "colour": "orange", "code": "        proc.returncode = None\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "53", "colour": "orange", "code": "        proc.stdout = None\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "54", "colour": "orange", "code": "        proc.stdin = None\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "55", "colour": "orange", "code": "        proc.stderr = None\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "56", "colour": "orange", "code": "        proc.pid = secondpid\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "57", "colour": "orange", "code": "        proc.universal_newlines = False\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "58", "colour": "green", "code": "        proc._input = None\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "59", "colour": "green", "code": "        proc._communication_started = False\n", "error": "W", "author": "tomerfiliba@gmail.com"}, {"index": "60", "colour": "orange", "code": "        proc.args = argv\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "61", "colour": "orange", "code": "        proc.argv = argv\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "62", "colour": "orange", "code": "        \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "63", "colour": "orange", "code": "        def poll(self = proc):\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "64", "colour": "orange", "code": "            if self.returncode is None:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "65", "colour": "orange", "code": "                try:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "66", "colour": "orange", "code": "                    os.kill(self.pid, 0)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "67", "colour": "orange", "code": "                except OSError:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "68", "colour": "orange", "code": "                    ex = sys.exc_info()[1]\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "69", "colour": "orange", "code": "                    if ex.errno == errno.ESRCH:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "70", "colour": "orange", "code": "                        # process does not exist\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "71", "colour": "orange", "code": "                        self.returncode = 0\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "72", "colour": "orange", "code": "                    else:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "73", "colour": "orange", "code": "                        raise\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "74", "colour": "orange", "code": "            return self.returncode\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "75", "colour": "orange", "code": "        \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "76", "colour": "orange", "code": "        def wait(self = proc):\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "77", "colour": "orange", "code": "            while self.returncode is None:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "78", "colour": "orange", "code": "                if self.poll() is None:\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "79", "colour": "orange", "code": "                    time.sleep(0.5)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "80", "colour": "orange", "code": "            return proc.returncode                \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "81", "colour": "orange", "code": "        \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "82", "colour": "orange", "code": "        proc.poll = poll\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "83", "colour": "orange", "code": "        proc.wait = wait\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "84", "colour": "orange", "code": "        return proc\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "85", "colour": "orange", "code": "\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "86", "colour": "orange", "code": "\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "87", "colour": "orange", "code": "def win32_daemonize(command, cwd):\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "88", "colour": "orange", "code": "    DETACHED_PROCESS = 0x00000008\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "89", "colour": "orange", "code": "    stdin = open(os.devnull, \"r\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "90", "colour": "orange", "code": "    stdout = open(os.devnull, \"w\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "91", "colour": "orange", "code": "    stderr = open(os.devnull, \"w\")\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "92", "colour": "orange", "code": "    return command.popen(cwd = cwd, stdin = stdin.fileno(), stdout = stdout.fileno(), stderr = stderr.fileno(), \n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "93", "colour": "orange", "code": "        creationflags = subprocess.CREATE_NEW_PROCESS_GROUP | DETACHED_PROCESS)\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "94", "colour": "orange", "code": "\n", "error": "none", "author": "tomerfiliba@gmail.com"}, {"index": "95", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "96", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "97", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "98", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}, {"index": "99", "colour": "orange", "code": "\n", "error": "none", "author": "Tomer.Filiba@emc.com"}]}