{"path": "/home/asumal/git/cs410/pattern/pattern/web/pdf/pdfdevice.py", "lines": [[{"index": "1", "colour": "orange", "code": "#!/usr/bin/env python2\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "green", "code": "import sys\n", "error": "W", "author": "tom@organisms.be"}, {"index": "3", "colour": "green", "code": "from utils import mult_matrix, translate_matrix\n", "error": "W", "author": "tom@organisms.be"}, {"index": "4", "colour": "green", "code": "from utils import enc, bbox2str\n", "error": "W", "author": "tom@organisms.be"}, {"index": "5", "colour": "green", "code": "from pdffont import PDFUnicodeNotDefined\n", "error": "W", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "##  PDFDevice\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "##\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "class PDFDevice(object):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "    debug = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "    def __init__(self, rsrcmgr):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "        self.rsrcmgr = rsrcmgr\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "        self.ctm = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "    def __repr__(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "        return '<PDFDevice>'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "blue", "code": "    def close(self):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "    def set_ctm(self, ctm):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "        self.ctm = ctm\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "blue", "code": "    def begin_tag(self, tag, props=None):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "blue", "code": "    def end_tag(self):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "blue", "code": "    def do_tag(self, tag, props=None):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "36", "colour": "blue", "code": "    def begin_page(self, page, ctm):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "blue", "code": "    def end_page(self, page):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "blue", "code": "    def begin_figure(self, name, bbox, matrix):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "blue", "code": "    def end_figure(self, name):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "43", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "blue", "code": "    def paint_path(self, graphicstate, stroke, fill, evenodd, path):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "blue", "code": "    def render_image(self, name, stream):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "blue", "code": "    def render_string(self, textstate, seq):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "##  PDFTextDevice\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "##\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "class PDFTextDevice(PDFDevice):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "    def render_string(self, textstate, seq):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "        matrix = mult_matrix(textstate.matrix, self.ctm)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "        font = textstate.font\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "        fontsize = textstate.fontsize\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "        scaling = textstate.scaling * .01\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "        charspace = textstate.charspace * scaling\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "        wordspace = textstate.wordspace * scaling\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "        rise = textstate.rise\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "        if font.is_multibyte():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "            wordspace = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "        dxscale = .001 * fontsize * scaling\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "        if font.is_vertical():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "            textstate.linematrix = self.render_string_vertical(\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "                seq, matrix, textstate.linematrix, font, fontsize,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "orange", "code": "                scaling, charspace, wordspace, rise, dxscale)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "72", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "            textstate.linematrix = self.render_string_horizontal(\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "                seq, matrix, textstate.linematrix, font, fontsize,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "orange", "code": "                scaling, charspace, wordspace, rise, dxscale)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "    \n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "blue", "code": "    def render_string_horizontal(self, seq, matrix, (x,y), \n", "error": "R", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "                                 font, fontsize, scaling, charspace, wordspace, rise, dxscale):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "        needcharspace = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "        for obj in seq:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "            if isinstance(obj, int) or isinstance(obj, float):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "                x -= obj*dxscale\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "                needcharspace = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "                for cid in font.decode(obj):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "orange", "code": "                    if needcharspace:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "                        x += charspace\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "                    x += self.render_char(translate_matrix(matrix, (x,y)),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "orange", "code": "                                          font, fontsize, scaling, rise, cid)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "                    if cid == 32 and wordspace:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "92", "colour": "orange", "code": "                        x += wordspace\n", "error": "none", "author": "tom@organisms.be"}, {"index": "93", "colour": "orange", "code": "                    needcharspace = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "94", "colour": "orange", "code": "        return (x, y)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "95", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "96", "colour": "blue", "code": "    def render_string_vertical(self, seq, matrix, (x,y), \n", "error": "R", "author": "tom@organisms.be"}, {"index": "97", "colour": "orange", "code": "                               font, fontsize, scaling, charspace, wordspace, rise, dxscale):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "98", "colour": "orange", "code": "        needcharspace = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "99", "colour": "orange", "code": "        for obj in seq:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "100", "colour": "orange", "code": "            if isinstance(obj, int) or isinstance(obj, float):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "101", "colour": "orange", "code": "                y -= obj*dxscale\n", "error": "none", "author": "tom@organisms.be"}, {"index": "102", "colour": "orange", "code": "                needcharspace = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "103", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "104", "colour": "orange", "code": "                for cid in font.decode(obj):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "105", "colour": "orange", "code": "                    if needcharspace:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "106", "colour": "orange", "code": "                        y += charspace\n", "error": "none", "author": "tom@organisms.be"}, {"index": "107", "colour": "orange", "code": "                    y += self.render_char(translate_matrix(matrix, (x,y)), \n", "error": "none", "author": "tom@organisms.be"}, {"index": "108", "colour": "orange", "code": "                                          font, fontsize, scaling, rise, cid)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "109", "colour": "orange", "code": "                    if cid == 32 and wordspace:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "110", "colour": "orange", "code": "                        y += wordspace\n", "error": "none", "author": "tom@organisms.be"}, {"index": "111", "colour": "orange", "code": "                    needcharspace = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "112", "colour": "orange", "code": "        return (x, y)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "113", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "114", "colour": "blue", "code": "    def render_char(self, matrix, font, fontsize, scaling, rise, cid):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "115", "colour": "orange", "code": "        return 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "116", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "117", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "118", "colour": "orange", "code": "##  TagExtractor\n", "error": "none", "author": "tom@organisms.be"}, {"index": "119", "colour": "orange", "code": "##\n", "error": "none", "author": "tom@organisms.be"}, {"index": "120", "colour": "orange", "code": "class TagExtractor(PDFDevice):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "121", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "122", "colour": "orange", "code": "    def __init__(self, rsrcmgr, outfp, codec='utf-8', debug=0):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "123", "colour": "orange", "code": "        PDFDevice.__init__(self, rsrcmgr)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "124", "colour": "orange", "code": "        self.outfp = outfp\n", "error": "none", "author": "tom@organisms.be"}, {"index": "125", "colour": "orange", "code": "        self.codec = codec\n", "error": "none", "author": "tom@organisms.be"}, {"index": "126", "colour": "orange", "code": "        self.debug = debug\n", "error": "none", "author": "tom@organisms.be"}, {"index": "127", "colour": "orange", "code": "        self.pageno = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "128", "colour": "orange", "code": "        self._stack = []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "129", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "130", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "131", "colour": "orange", "code": "    def render_string(self, textstate, seq):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "132", "colour": "orange", "code": "        font = textstate.font\n", "error": "none", "author": "tom@organisms.be"}, {"index": "133", "colour": "orange", "code": "        text = ''\n", "error": "none", "author": "tom@organisms.be"}, {"index": "134", "colour": "orange", "code": "        for obj in seq:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "135", "colour": "orange", "code": "            if not isinstance(obj, str): continue\n", "error": "none", "author": "tom@organisms.be"}, {"index": "136", "colour": "orange", "code": "            chars = font.decode(obj)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "137", "colour": "orange", "code": "            for cid in chars:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "138", "colour": "orange", "code": "                try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "139", "colour": "orange", "code": "                    char = font.to_unichr(cid)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "140", "colour": "orange", "code": "                    text += char\n", "error": "none", "author": "tom@organisms.be"}, {"index": "141", "colour": "orange", "code": "                except PDFUnicodeNotDefined:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "142", "colour": "orange", "code": "                    pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "143", "colour": "orange", "code": "        self.outfp.write(enc(text, self.codec))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "144", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "145", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "146", "colour": "orange", "code": "    def begin_page(self, page, ctm):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "147", "colour": "orange", "code": "        self.outfp.write('<page id=\"%s\" bbox=\"%s\" rotate=\"%d\">' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "148", "colour": "orange", "code": "                         (self.pageno, bbox2str(page.mediabox), page.rotate))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "149", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "150", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "151", "colour": "orange", "code": "    def end_page(self, page):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "152", "colour": "orange", "code": "        self.outfp.write('</page>\\n')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "153", "colour": "orange", "code": "        self.pageno += 1\n", "error": "none", "author": "tom@organisms.be"}, {"index": "154", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "155", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "156", "colour": "orange", "code": "    def begin_tag(self, tag, props=None):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "157", "colour": "orange", "code": "        s = ''\n", "error": "none", "author": "tom@organisms.be"}, {"index": "158", "colour": "orange", "code": "        if isinstance(props, dict):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "159", "colour": "orange", "code": "            s = ''.join( ' %s=\"%s\"' % (enc(k), enc(str(v))) for (k,v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "160", "colour": "orange", "code": "                         in sorted(props.iteritems()) )\n", "error": "none", "author": "tom@organisms.be"}, {"index": "161", "colour": "orange", "code": "        self.outfp.write('<%s%s>' % (enc(tag.name), s))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "162", "colour": "orange", "code": "        self._stack.append(tag)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "163", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "164", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "165", "colour": "orange", "code": "    def end_tag(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "166", "colour": "orange", "code": "        assert self._stack\n", "error": "none", "author": "tom@organisms.be"}, {"index": "167", "colour": "orange", "code": "        tag = self._stack.pop(-1)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "168", "colour": "orange", "code": "        self.outfp.write('</%s>' % enc(tag.name))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "169", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "170", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "171", "colour": "orange", "code": "    def do_tag(self, tag, props=None):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "172", "colour": "orange", "code": "        self.begin_tag(tag, props)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "173", "colour": "orange", "code": "        self._stack.pop(-1)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "174", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}]]}