{"path": "/home/asumal/git/cs410/pattern/pattern/web/pdf/lzw.py", "lines": [{"index": "1", "colour": "orange", "code": "#!/usr/bin/env python2\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "orange", "code": "import sys\n", "error": "none", "author": "tom@organisms.be"}, {"index": "3", "colour": "orange", "code": "try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "4", "colour": "orange", "code": "    from cStringIO import StringIO\n", "error": "none", "author": "tom@organisms.be"}, {"index": "5", "colour": "orange", "code": "except ImportError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "    from StringIO import StringIO\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "##  LZWDecoder\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "##\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "class LZWDecoder(object):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "orange", "code": "    debug = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "    def __init__(self, fp):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "        self.fp = fp\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "        self.buff = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "        self.bpos = 8\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "        self.nbits = 9\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "        self.table = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "        self.prevbuf = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "    def readbits(self, bits):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "        v = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "        while 1:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "            # the number of remaining bits we can get from the current buffer.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "            r = 8-self.bpos\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "orange", "code": "            if bits <= r:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "                # |-----8-bits-----|\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "orange", "code": "                # |-bpos-|-bits-|  |\n", "error": "none", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "                # |      |----r----|\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "orange", "code": "                v = (v<<bits) | ((self.buff>>(r-bits)) & ((1<<bits)-1))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "                self.bpos += bits\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "orange", "code": "                break\n", "error": "none", "author": "tom@organisms.be"}, {"index": "36", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "                # |-----8-bits-----|\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "orange", "code": "                # |-bpos-|---bits----...\n", "error": "none", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "                # |      |----r----|\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "orange", "code": "                v = (v<<r) | (self.buff & ((1<<r)-1))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "                bits -= r\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "orange", "code": "                x = self.fp.read(1)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "43", "colour": "orange", "code": "                if not x: raise EOFError\n", "error": "none", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "                self.buff = ord(x)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "orange", "code": "                self.bpos = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "        return v\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "    def feed(self, code):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "orange", "code": "        x = ''\n", "error": "none", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "        if code == 256:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "            self.table = [ chr(c) for c in xrange(256) ] # 0-255\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "            self.table.append(None) # 256\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "            self.table.append(None) # 257\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "            self.prevbuf = ''\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "            self.nbits = 9\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "        elif code == 257:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "            pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "        elif not self.prevbuf:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "            x = self.prevbuf = self.table[code]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "            if code < len(self.table):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "                x = self.table[code]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "                self.table.append(self.prevbuf+x[0])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "                self.table.append(self.prevbuf+self.prevbuf[0])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "                x = self.table[code]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "            l = len(self.table)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "            if l == 511:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "                self.nbits = 10\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "            elif l == 1023:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "orange", "code": "                self.nbits = 11\n", "error": "none", "author": "tom@organisms.be"}, {"index": "72", "colour": "orange", "code": "            elif l == 2047:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "                self.nbits = 12\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "            self.prevbuf = x\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "orange", "code": "        return x\n", "error": "none", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "    def run(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "orange", "code": "        while 1:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "            try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "                code = self.readbits(self.nbits)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "            except EOFError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "                break\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "            x = self.feed(code)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "            yield x\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "                print >>sys.stderr, ('nbits=%d, code=%d, output=%r, table=%r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "orange", "code": "                                     (self.nbits, code, x, self.table[258:]))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "orange", "code": "# lzwdecode\n", "error": "none", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "def lzwdecode(data):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "92", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "93", "colour": "orange", "code": "    >>> lzwdecode('\\x80\\x0b\\x60\\x50\\x22\\x0c\\x0c\\x85\\x01')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "94", "colour": "orange", "code": "    '\\x2d\\x2d\\x2d\\x2d\\x2d\\x41\\x2d\\x2d\\x2d\\x42'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "95", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "96", "colour": "orange", "code": "    fp = StringIO(data)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "97", "colour": "orange", "code": "    return ''.join(LZWDecoder(fp).run())\n", "error": "none", "author": "tom@organisms.be"}, {"index": "98", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "99", "colour": "orange", "code": "if __name__ == '__main__':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "100", "colour": "orange", "code": "    import doctest\n", "error": "none", "author": "tom@organisms.be"}, {"index": "101", "colour": "orange", "code": "    doctest.testmod()\n", "error": "none", "author": "tom@organisms.be"}]}