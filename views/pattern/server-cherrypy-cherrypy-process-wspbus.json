{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/process/wspbus.py", "lines": [[{"error": "W", "line": "1", "code": "\"\"\"An implementation of the Web Site Process Bus.\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "2", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "3", "code": "This module is completely standalone, depending only on the stdlib.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "4", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "5", "code": "Web Site Process Bus\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "6", "code": "--------------------\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "7", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "8", "code": "A Bus object is used to contain and manage site-wide behavior:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "9", "code": "daemonization, HTTP server start/stop, process reload, signal handling,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "10", "code": "drop privileges, PID file management, logging for all of these,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "11", "code": "and many more.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "12", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "13", "code": "In addition, a Bus object provides a place for each web framework\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "14", "code": "to register code that runs in response to site-wide events (like\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "15", "code": "process start and stop), or which controls or otherwise interacts with\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "16", "code": "the site-wide components mentioned above. For example, a framework which\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "17", "code": "uses file-based templates would add known template filenames to an\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "18", "code": "autoreload component.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "19", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "20", "code": "Ideally, a Bus object will be flexible enough to be useful in a variety\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "21", "code": "of invocation scenarios:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "22", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "23", "code": " 1. The deployer starts a site from the command line via a\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "24", "code": "    framework-neutral deployment script; applications from multiple frameworks\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "25", "code": "    are mixed in a single site. Command-line arguments and configuration\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "26", "code": "    files are used to define site-wide components such as the HTTP server,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "27", "code": "    WSGI component graph, autoreload behavior, signal handling, etc.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "28", "code": " 2. The deployer starts a site via some other process, such as Apache;\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "29", "code": "    applications from multiple frameworks are mixed in a single site.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "30", "code": "    Autoreload and signal handling (from Python at least) are disabled.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "31", "code": " 3. The deployer starts a site via a framework-specific mechanism;\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "32", "code": "    for example, when running tests, exploring tutorials, or deploying\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "33", "code": "    single applications from a single framework. The framework controls\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "34", "code": "    which site-wide components are enabled as it sees fit.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "35", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "36", "code": "The Bus object in this package uses topic-based publish-subscribe\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "37", "code": "messaging to accomplish all this. A few topic channels are built in\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "38", "code": "('start', 'stop', 'exit', 'graceful', 'log', and 'main'). Frameworks and\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "39", "code": "site containers are free to define their own. If a message is sent to a\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "40", "code": "channel that has not been defined or has no listeners, there is no effect.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "41", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "42", "code": "In general, there should only ever be a single Bus object per process.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "43", "code": "Frameworks and site containers share a single Bus object by publishing\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "44", "code": "messages and subscribing listeners.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "45", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "46", "code": "The Bus object works as a finite state machine which models the current\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "47", "code": "state of the process. Bus methods move it from one state to another;\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "48", "code": "those methods then publish to subscribed listeners on the channel for\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "49", "code": "the new state.::\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "50", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "51", "code": "                        O\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "52", "code": "                        |\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "53", "code": "                        V\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "54", "code": "       STOPPING --> STOPPED --> EXITING -> X\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "55", "code": "          A   A         |\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "56", "code": "          |    \\___     |\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "57", "code": "          |        \\    |\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "58", "code": "          |         V   V\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "59", "code": "        STARTED <-- STARTING\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "60", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "61", "code": "\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "62", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "63", "code": "import atexit\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "64", "code": "import os\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "65", "code": "import sys\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "66", "code": "import threading\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "67", "code": "import time\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "68", "code": "import traceback as _traceback\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "69", "code": "import warnings\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "70", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "71", "code": "from cherrypy._cpcompat import set\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "72", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "73", "code": "# Here I save the value of os.getcwd(), which, if I am imported early enough,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "74", "code": "# will be the directory from which the startup script was run.  This is needed\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "75", "code": "# by _do_execv(), to change back to the original directory before execv()ing a\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "76", "code": "# new process.  This is a defense against the application having changed the\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "77", "code": "# current working directory (which could make sys.executable \"not found\" if\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "78", "code": "# sys.executable is a relative-path, and/or cause other problems).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "79", "code": "_startup_cwd = os.getcwd()\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "80", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "81", "code": "class ChannelFailures(Exception):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "82", "code": "    \"\"\"Exception raised when errors occur in a listener during Bus.publish().\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "83", "code": "    delimiter = '\\n'\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "84", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "85", "code": "    def __init__(self, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "86", "code": "        # Don't use 'super' here; Exceptions are old-style in Py2.4\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "87", "code": "        # See http://www.cherrypy.org/ticket/959\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "88", "code": "        Exception.__init__(self, *args, **kwargs)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "89", "code": "        self._exceptions = list()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "90", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "91", "code": "    def handle_exception(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "92", "code": "        \"\"\"Append the current exception to self.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "93", "code": "        self._exceptions.append(sys.exc_info()[1])\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "94", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "95", "code": "    def get_instances(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "96", "code": "        \"\"\"Return a list of seen exception instances.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "97", "code": "        return self._exceptions[:]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "98", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "99", "code": "    def __str__(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "100", "code": "        exception_strings = map(repr, self.get_instances())\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "101", "code": "        return self.delimiter.join(exception_strings)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "102", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "103", "code": "    __repr__ = __str__\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "104", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "105", "code": "    def __bool__(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "106", "code": "        return bool(self._exceptions)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "107", "code": "    __nonzero__ = __bool__\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "108", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "109", "code": "# Use a flag to indicate the state of the bus.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "R", "line": "110", "code": "class _StateEnum(object):\n", "colour": "green", "author": "tom@organisms.be"}, {"error": "R", "line": "111", "code": "    class State(object):\n", "colour": "green", "author": "tom@organisms.be"}, {"error": "none", "line": "112", "code": "        name = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "113", "code": "        def __repr__(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "114", "code": "            return \"states.%s\" % self.name\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "115", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "116", "code": "    def __setattr__(self, key, value):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "117", "code": "        if isinstance(value, self.State):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "118", "code": "            value.name = key\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "119", "code": "        object.__setattr__(self, key, value)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "120", "code": "states = _StateEnum()\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "W", "line": "121", "code": "states.STOPPED = states.State()\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "W", "line": "122", "code": "states.STARTING = states.State()\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "W", "line": "123", "code": "states.STARTED = states.State()\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "W", "line": "124", "code": "states.STOPPING = states.State()\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "W", "line": "125", "code": "states.EXITING = states.State()\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "126", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "127", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "128", "code": "try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "129", "code": "    import fcntl\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "130", "code": "except ImportError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "131", "code": "    max_files = 0\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "132", "code": "else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "133", "code": "    try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "134", "code": "        max_files = os.sysconf('SC_OPEN_MAX')\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "135", "code": "    except AttributeError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "136", "code": "        max_files = 1024\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "137", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "138", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "R", "line": "139", "code": "class Bus(object):\n", "colour": "green", "author": "tom@organisms.be"}, {"error": "none", "line": "140", "code": "    \"\"\"Process state-machine and messenger for HTTP site deployment.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "141", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "142", "code": "    All listeners for a given channel are guaranteed to be called even\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "143", "code": "    if others at the same channel fail. Each failure is logged, but\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "144", "code": "    execution proceeds on to the next listener. The only way to stop all\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "145", "code": "    processing from inside a listener is to raise SystemExit and stop the\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "146", "code": "    whole server.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "147", "code": "    \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "148", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "149", "code": "    states = states\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "150", "code": "    state = states.STOPPED\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "151", "code": "    execv = False\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "152", "code": "    max_cloexec_files = max_files\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "153", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "154", "code": "    def __init__(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "155", "code": "        self.execv = False\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "156", "code": "        self.state = states.STOPPED\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "157", "code": "        self.listeners = dict(\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "158", "code": "            [(channel, set()) for channel\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "159", "code": "             in ('start', 'stop', 'exit', 'graceful', 'log', 'main')])\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "160", "code": "        self._priorities = {}\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "161", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "162", "code": "    def subscribe(self, channel, callback, priority=None):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "163", "code": "        \"\"\"Add the given callback at the given channel (if not present).\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "164", "code": "        if channel not in self.listeners:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "165", "code": "            self.listeners[channel] = set()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "166", "code": "        self.listeners[channel].add(callback)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "167", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "168", "code": "        if priority is None:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "169", "code": "            priority = getattr(callback, 'priority', 50)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "170", "code": "        self._priorities[(channel, callback)] = priority\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "171", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "172", "code": "    def unsubscribe(self, channel, callback):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "173", "code": "        \"\"\"Discard the given callback (if present).\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "174", "code": "        listeners = self.listeners.get(channel)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "175", "code": "        if listeners and callback in listeners:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "176", "code": "            listeners.discard(callback)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "177", "code": "            del self._priorities[(channel, callback)]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "178", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "179", "code": "    def publish(self, channel, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "180", "code": "        \"\"\"Return output of all subscribers for the given channel.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "181", "code": "        if channel not in self.listeners:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "182", "code": "            return []\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "183", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "184", "code": "        exc = ChannelFailures()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "185", "code": "        output = []\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "186", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "187", "code": "        items = [(self._priorities[(channel, listener)], listener)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "188", "code": "                 for listener in self.listeners[channel]]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "189", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "190", "code": "            items.sort(key=lambda item: item[0])\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "191", "code": "        except TypeError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "192", "code": "            # Python 2.3 had no 'key' arg, but that doesn't matter\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "193", "code": "            # since it could sort dissimilar types just fine.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "194", "code": "            items.sort()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "195", "code": "        for priority, listener in items:\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "196", "code": "            try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "197", "code": "                output.append(listener(*args, **kwargs))\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "198", "code": "            except KeyboardInterrupt:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "199", "code": "                raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "200", "code": "            except SystemExit:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "201", "code": "                e = sys.exc_info()[1]\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "202", "code": "                # If we have previous errors ensure the exit code is non-zero\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "203", "code": "                if exc and e.code == 0:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "204", "code": "                    e.code = 1\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "205", "code": "                raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "206", "code": "            except:\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "207", "code": "                exc.handle_exception()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "208", "code": "                if channel == 'log':\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "209", "code": "                    # Assume any further messages to 'log' will fail.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "210", "code": "                    pass\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "211", "code": "                else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "212", "code": "                    self.log(\"Error in %r listener %r\" % (channel, listener),\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "213", "code": "                             level=40, traceback=True)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "214", "code": "        if exc:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "215", "code": "            raise exc\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "216", "code": "        return output\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "217", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "218", "code": "    def _clean_exit(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "219", "code": "        \"\"\"An atexit handler which asserts the Bus is not running.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "220", "code": "        if self.state != states.EXITING:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "221", "code": "            warnings.warn(\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "222", "code": "                \"The main thread is exiting, but the Bus is in the %r state; \"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "223", "code": "                \"shutting it down automatically now. You must either call \"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "224", "code": "                \"bus.block() after start(), or call bus.exit() before the \"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "225", "code": "                \"main thread exits.\" % self.state, RuntimeWarning)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "226", "code": "            self.exit()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "227", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "228", "code": "    def start(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "229", "code": "        \"\"\"Start all services.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "230", "code": "        atexit.register(self._clean_exit)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "231", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "232", "code": "        self.state = states.STARTING\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "233", "code": "        self.log('Bus STARTING')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "234", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "235", "code": "            self.publish('start')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "236", "code": "            self.state = states.STARTED\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "237", "code": "            self.log('Bus STARTED')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "238", "code": "        except (KeyboardInterrupt, SystemExit):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "239", "code": "            raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "240", "code": "        except:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "241", "code": "            self.log(\"Shutting down due to error in start listener:\",\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "242", "code": "                     level=40, traceback=True)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "243", "code": "            e_info = sys.exc_info()[1]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "244", "code": "            try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "245", "code": "                self.exit()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "246", "code": "            except:\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "247", "code": "                # Any stop/exit errors will be logged inside publish().\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "248", "code": "                pass\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "249", "code": "            # Re-raise the original error\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "250", "code": "            raise e_info\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "251", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "252", "code": "    def exit(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "253", "code": "        \"\"\"Stop all services and prepare to exit the process.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "254", "code": "        exitstate = self.state\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "255", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "256", "code": "            self.stop()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "257", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "258", "code": "            self.state = states.EXITING\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "259", "code": "            self.log('Bus EXITING')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "260", "code": "            self.publish('exit')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "261", "code": "            # This isn't strictly necessary, but it's better than seeing\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "262", "code": "            # \"Waiting for child threads to terminate...\" and then nothing.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "263", "code": "            self.log('Bus EXITED')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "264", "code": "        except:\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "265", "code": "            # This method is often called asynchronously (whether thread,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "266", "code": "            # signal handler, console handler, or atexit handler), so we\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "267", "code": "            # can't just let exceptions propagate out unhandled.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "268", "code": "            # Assume it's been logged and just die.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "269", "code": "            os._exit(70) # EX_SOFTWARE\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "270", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "271", "code": "        if exitstate == states.STARTING:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "272", "code": "            # exit() was called before start() finished, possibly due to\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "273", "code": "            # Ctrl-C because a start listener got stuck. In this case,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "274", "code": "            # we could get stuck in a loop where Ctrl-C never exits the\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "275", "code": "            # process, so we just call os.exit here.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "276", "code": "            os._exit(70) # EX_SOFTWARE\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "277", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "278", "code": "    def restart(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "279", "code": "        \"\"\"Restart the process (may close connections).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "280", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "281", "code": "        This method does not restart the process from the calling thread;\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "282", "code": "        instead, it stops the bus and asks the main thread to call execv.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "283", "code": "        \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "284", "code": "        self.execv = True\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "285", "code": "        self.exit()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "286", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "287", "code": "    def graceful(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "288", "code": "        \"\"\"Advise all services to reload.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "289", "code": "        self.log('Bus graceful')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "290", "code": "        self.publish('graceful')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "291", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "292", "code": "    def block(self, interval=0.1):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "293", "code": "        \"\"\"Wait for the EXITING state, KeyboardInterrupt or SystemExit.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "294", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "295", "code": "        This function is intended to be called only by the main thread.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "296", "code": "        After waiting for the EXITING state, it also waits for all threads\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "297", "code": "        to terminate, and then calls os.execv if self.execv is True. This\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "298", "code": "        design allows another thread to call bus.restart, yet have the main\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "299", "code": "        thread perform the actual execv call (required on some platforms).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "300", "code": "        \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "301", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "302", "code": "            self.wait(states.EXITING, interval=interval, channel='main')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "303", "code": "        except (KeyboardInterrupt, IOError):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "304", "code": "            # The time.sleep call might raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "305", "code": "            # \"IOError: [Errno 4] Interrupted function call\" on KBInt.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "306", "code": "            self.log('Keyboard Interrupt: shutting down bus')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "307", "code": "            self.exit()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "308", "code": "        except SystemExit:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "309", "code": "            self.log('SystemExit raised: shutting down bus')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "310", "code": "            self.exit()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "311", "code": "            raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "312", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "313", "code": "        # Waiting for ALL child threads to finish is necessary on OS X.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "314", "code": "        # See http://www.cherrypy.org/ticket/581.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "315", "code": "        # It's also good to let them all shut down before allowing\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "316", "code": "        # the main thread to call atexit handlers.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "317", "code": "        # See http://www.cherrypy.org/ticket/751.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "318", "code": "        self.log(\"Waiting for child threads to terminate...\")\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "319", "code": "        for t in threading.enumerate():\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "320", "code": "            if t != threading.currentThread() and t.isAlive():\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "321", "code": "                # Note that any dummy (external) threads are always daemonic.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "322", "code": "                if hasattr(threading.Thread, \"daemon\"):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "323", "code": "                    # Python 2.6+\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "324", "code": "                    d = t.daemon\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "325", "code": "                else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "326", "code": "                    d = t.isDaemon()\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "327", "code": "                if not d:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "328", "code": "                    self.log(\"Waiting for thread %s.\" % t.getName())\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "329", "code": "                    t.join()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "330", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "331", "code": "        if self.execv:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "332", "code": "            self._do_execv()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "333", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "334", "code": "    def wait(self, state, interval=0.1, channel=None):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "335", "code": "        \"\"\"Poll for the given state(s) at intervals; publish to channel.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "336", "code": "        if isinstance(state, (tuple, list)):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "337", "code": "            states = state\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "338", "code": "        else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "339", "code": "            states = [state]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "340", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "341", "code": "        def _wait():\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "342", "code": "            while self.state not in states:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "343", "code": "                time.sleep(interval)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "344", "code": "                self.publish(channel)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "345", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "346", "code": "        # From http://psyco.sourceforge.net/psycoguide/bugs.html:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "347", "code": "        # \"The compiled machine code does not include the regular polling\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "348", "code": "        # done by Python, meaning that a KeyboardInterrupt will not be\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "349", "code": "        # detected before execution comes back to the regular Python\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "350", "code": "        # interpreter. Your program cannot be interrupted if caught\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "351", "code": "        # into an infinite Psyco-compiled loop.\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "352", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "353", "code": "            sys.modules['psyco'].cannotcompile(_wait)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "354", "code": "        except (KeyError, AttributeError):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "355", "code": "            pass\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "356", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "357", "code": "        _wait()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "358", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "359", "code": "    def _do_execv(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "360", "code": "        \"\"\"Re-execute the current process.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "361", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "362", "code": "        This must be called from the main thread, because certain platforms\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "363", "code": "        (OS X) don't allow execv to be called in a child thread very well.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "364", "code": "        \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "365", "code": "        args = sys.argv[:]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "366", "code": "        self.log('Re-spawning %s' % ' '.join(args))\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "367", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "368", "code": "        if sys.platform[:4] == 'java':\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "F", "line": "369", "code": "            from _systemrestart import SystemRestart\n", "colour": "red", "author": "tom@organisms.be"}, {"error": "none", "line": "370", "code": "            raise SystemRestart\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "371", "code": "        else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "372", "code": "            args.insert(0, sys.executable)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "373", "code": "            if sys.platform == 'win32':\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "374", "code": "                args = ['\"%s\"' % arg for arg in args]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "375", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "376", "code": "            os.chdir(_startup_cwd)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "377", "code": "            if self.max_cloexec_files:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "378", "code": "                self._set_cloexec()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "379", "code": "            os.execv(sys.executable, args)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "380", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "381", "code": "    def _set_cloexec(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "382", "code": "        \"\"\"Set the CLOEXEC flag on all open files (except stdin/out/err).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "383", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "384", "code": "        If self.max_cloexec_files is an integer (the default), then on\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "385", "code": "        platforms which support it, it represents the max open files setting\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "386", "code": "        for the operating system. This function will be called just before\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "387", "code": "        the process is restarted via os.execv() to prevent open files\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "388", "code": "        from persisting into the new process.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "389", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "390", "code": "        Set self.max_cloexec_files to 0 to disable this behavior.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "391", "code": "        \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "392", "code": "        for fd in range(3, self.max_cloexec_files): # skip stdin/out/err\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "393", "code": "            try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "394", "code": "                flags = fcntl.fcntl(fd, fcntl.F_GETFD)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "395", "code": "            except IOError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "396", "code": "                continue\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "397", "code": "            fcntl.fcntl(fd, fcntl.F_SETFD, flags | fcntl.FD_CLOEXEC)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "398", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "399", "code": "    def stop(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "400", "code": "        \"\"\"Stop all services.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "401", "code": "        self.state = states.STOPPING\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "402", "code": "        self.log('Bus STOPPING')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "403", "code": "        self.publish('stop')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "404", "code": "        self.state = states.STOPPED\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "405", "code": "        self.log('Bus STOPPED')\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "406", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "407", "code": "    def start_with_callback(self, func, args=None, kwargs=None):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "408", "code": "        \"\"\"Start 'func' in a new thread T, then start self (and return T).\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "409", "code": "        if args is None:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "410", "code": "            args = ()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "411", "code": "        if kwargs is None:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "412", "code": "            kwargs = {}\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "413", "code": "        args = (func,) + args\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "414", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "415", "code": "        def _callback(func, *a, **kw):\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "416", "code": "            self.wait(states.STARTED)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "417", "code": "            func(*a, **kw)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "418", "code": "        t = threading.Thread(target=_callback, args=args, kwargs=kwargs)\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "419", "code": "        t.setName('Bus Callback ' + t.getName())\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "420", "code": "        t.start()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "421", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "422", "code": "        self.start()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "423", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "424", "code": "        return t\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "425", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "426", "code": "    def log(self, msg=\"\", level=20, traceback=False):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "427", "code": "        \"\"\"Log the given message. Append the last traceback if requested.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "428", "code": "        if traceback:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "429", "code": "            msg += \"\\n\" + \"\".join(_traceback.format_exception(*sys.exc_info()))\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "430", "code": "        self.publish('log', msg, level)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "431", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "432", "code": "bus = Bus()", "colour": "blue", "author": "tom@alice-2.local"}]]}