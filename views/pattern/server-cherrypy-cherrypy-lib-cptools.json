{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/lib/cptools.py", "lines": [[{"index": "1", "colour": "orange", "code": "\"\"\"Functions for builtin CherryPy tools.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "3", "colour": "orange", "code": "import logging\n", "error": "none", "author": "tom@organisms.be"}, {"index": "4", "colour": "orange", "code": "import re\n", "error": "none", "author": "tom@organisms.be"}, {"index": "5", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "import cherrypy\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "green", "code": "from cherrypy._cpcompat import basestring, md5, set, unicodestr\n", "error": "W", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "from cherrypy.lib import httputil as _httputil\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "#                     Conditional HTTP request support                     #\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "blue", "code": "def validate_etags(autotags=False, debug=False):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "    \"\"\"Validate the current ETag against If-Match, If-None-Match headers.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "    If autotags is True, an ETag response-header value will be provided\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "    from an MD5 hash of the response body (unless some other code has\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "    already provided an ETag header). If False (the default), the ETag\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "    will not be automatic.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "    WARNING: the autotags feature is not designed for URL's which allow\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "orange", "code": "    methods other than GET. For example, if a POST to the same URL returns\n", "error": "none", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "    no content, the automatic ETag will be incorrect, breaking a fundamental\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "    use for entity tags in a possibly destructive fashion. Likewise, if you\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "    raise 304 Not Modified, the response body will be empty, the ETag hash\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "    will be incorrect, and your application will break.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "    See :rfc:`2616` Section 14.24.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "orange", "code": "    response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "orange", "code": "    # Guard against being run twice.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "    if hasattr(response, \"ETag\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "green", "code": "    status, reason, msg = _httputil.valid_status(response.status)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "36", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "    etag = response.headers.get('ETag')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "    # Automatic ETag generation. See warning in docstring.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "orange", "code": "    if etag:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "orange", "code": "            cherrypy.log('ETag already set: %s' % etag, 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "43", "colour": "orange", "code": "    elif not autotags:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "orange", "code": "            cherrypy.log('Autotags off', 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "    elif status != 200:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "            cherrypy.log('Status not 200', 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "        etag = response.collapse_body()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "        etag = '\"%s\"' % md5(etag).hexdigest()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "            cherrypy.log('Setting ETag: %s' % etag, 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "        response.headers['ETag'] = etag\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "    response.ETag = etag\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "    # \"If the request would, without the If-Match header field, result in\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "    # anything other than a 2xx or 412 status, then the If-Match header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "    # MUST be ignored.\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "        cherrypy.log('Status: %s' % status, 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "    if status >= 200 and status <= 299:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "        conditions = request.headers.elements('If-Match') or []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "        conditions = [str(x) for x in conditions]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "            cherrypy.log('If-Match conditions: %s' % repr(conditions),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "                         'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "orange", "code": "        if conditions and not (conditions == [\"*\"] or etag in conditions):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "72", "colour": "orange", "code": "            raise cherrypy.HTTPError(412, \"If-Match failed: ETag %r did \"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "                                     \"not match %r\" % (etag, conditions))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "orange", "code": "        conditions = request.headers.elements('If-None-Match') or []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "        conditions = [str(x) for x in conditions]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "orange", "code": "            cherrypy.log('If-None-Match conditions: %s' % repr(conditions),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "                         'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "        if conditions == [\"*\"] or etag in conditions:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "            if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "                cherrypy.log('request.method: %s' % request.method, 'TOOLS.ETAGS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "            if request.method in (\"GET\", \"HEAD\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "                raise cherrypy.HTTPRedirect([], 304)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "                raise cherrypy.HTTPError(412, \"If-None-Match failed: ETag %r \"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "orange", "code": "                                         \"matched %r\" % (etag, conditions))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "def validate_since():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "orange", "code": "    \"\"\"Validate the current Last-Modified against If-Modified-Since headers.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "92", "colour": "orange", "code": "    If no code has set the Last-Modified response header, then no validation\n", "error": "none", "author": "tom@organisms.be"}, {"index": "93", "colour": "orange", "code": "    will be performed.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "94", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "95", "colour": "orange", "code": "    response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "96", "colour": "orange", "code": "    lastmod = response.headers.get('Last-Modified')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "97", "colour": "orange", "code": "    if lastmod:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "98", "colour": "green", "code": "        status, reason, msg = _httputil.valid_status(response.status)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "99", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "100", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "101", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "102", "colour": "orange", "code": "        since = request.headers.get('If-Unmodified-Since')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "103", "colour": "orange", "code": "        if since and since != lastmod:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "104", "colour": "orange", "code": "            if (status >= 200 and status <= 299) or status == 412:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "105", "colour": "orange", "code": "                raise cherrypy.HTTPError(412)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "106", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "107", "colour": "orange", "code": "        since = request.headers.get('If-Modified-Since')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "108", "colour": "orange", "code": "        if since and since == lastmod:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "109", "colour": "orange", "code": "            if (status >= 200 and status <= 299) or status == 304:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "110", "colour": "orange", "code": "                if request.method in (\"GET\", \"HEAD\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "111", "colour": "orange", "code": "                    raise cherrypy.HTTPRedirect([], 304)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "112", "colour": "orange", "code": "                else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "113", "colour": "orange", "code": "                    raise cherrypy.HTTPError(412)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "114", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "115", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "116", "colour": "orange", "code": "#                                Tool code                                #\n", "error": "none", "author": "tom@organisms.be"}, {"index": "117", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "118", "colour": "orange", "code": "def allow(methods=None, debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "119", "colour": "orange", "code": "    \"\"\"Raise 405 if request.method not in methods (default ['GET', 'HEAD']).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "120", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "121", "colour": "orange", "code": "    The given methods are case-insensitive, and may be in any order.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "122", "colour": "orange", "code": "    If only one method is allowed, you may supply a single string;\n", "error": "none", "author": "tom@organisms.be"}, {"index": "123", "colour": "orange", "code": "    if more than one, supply a list of strings.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "124", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "125", "colour": "orange", "code": "    Regardless of whether the current method is allowed or not, this\n", "error": "none", "author": "tom@organisms.be"}, {"index": "126", "colour": "orange", "code": "    also emits an 'Allow' response header, containing the given methods.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "127", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "128", "colour": "orange", "code": "    if not isinstance(methods, (tuple, list)):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "129", "colour": "orange", "code": "        methods = [methods]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "130", "colour": "orange", "code": "    methods = [m.upper() for m in methods if m]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "131", "colour": "orange", "code": "    if not methods:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "132", "colour": "orange", "code": "        methods = ['GET', 'HEAD']\n", "error": "none", "author": "tom@organisms.be"}, {"index": "133", "colour": "orange", "code": "    elif 'GET' in methods and 'HEAD' not in methods:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "134", "colour": "orange", "code": "        methods.append('HEAD')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "135", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "136", "colour": "orange", "code": "    cherrypy.response.headers['Allow'] = ', '.join(methods)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "137", "colour": "orange", "code": "    if cherrypy.request.method not in methods:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "138", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "139", "colour": "orange", "code": "            cherrypy.log('request.method %r not in methods %r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "140", "colour": "orange", "code": "                         (cherrypy.request.method, methods), 'TOOLS.ALLOW')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "141", "colour": "orange", "code": "        raise cherrypy.HTTPError(405)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "142", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "143", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "144", "colour": "orange", "code": "            cherrypy.log('request.method %r in methods %r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "145", "colour": "orange", "code": "                         (cherrypy.request.method, methods), 'TOOLS.ALLOW')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "146", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "147", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "148", "colour": "blue", "code": "def proxy(base=None, local='X-Forwarded-Host', remote='X-Forwarded-For',\n", "error": "R", "author": "tom@organisms.be"}, {"index": "149", "colour": "orange", "code": "          scheme='X-Forwarded-Proto', debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "150", "colour": "orange", "code": "    \"\"\"Change the base URL (scheme://host[:port][/path]).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "151", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "152", "colour": "orange", "code": "    For running a CP server behind Apache, lighttpd, or other HTTP server.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "153", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "154", "colour": "orange", "code": "    For Apache and lighttpd, you should leave the 'local' argument at the\n", "error": "none", "author": "tom@organisms.be"}, {"index": "155", "colour": "orange", "code": "    default value of 'X-Forwarded-Host'. For Squid, you probably want to set\n", "error": "none", "author": "tom@organisms.be"}, {"index": "156", "colour": "orange", "code": "    tools.proxy.local = 'Origin'.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "157", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "158", "colour": "orange", "code": "    If you want the new request.base to include path info (not just the host),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "159", "colour": "orange", "code": "    you must explicitly set base to the full base path, and ALSO set 'local'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "160", "colour": "orange", "code": "    to '', so that the X-Forwarded-Host request header (which never includes\n", "error": "none", "author": "tom@organisms.be"}, {"index": "161", "colour": "orange", "code": "    path info) does not override it. Regardless, the value for 'base' MUST\n", "error": "none", "author": "tom@organisms.be"}, {"index": "162", "colour": "orange", "code": "    NOT end in a slash.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "163", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "164", "colour": "orange", "code": "    cherrypy.request.remote.ip (the IP address of the client) will be\n", "error": "none", "author": "tom@organisms.be"}, {"index": "165", "colour": "orange", "code": "    rewritten if the header specified by the 'remote' arg is valid.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "166", "colour": "orange", "code": "    By default, 'remote' is set to 'X-Forwarded-For'. If you do not\n", "error": "none", "author": "tom@organisms.be"}, {"index": "167", "colour": "orange", "code": "    want to rewrite remote.ip, set the 'remote' arg to an empty string.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "168", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "169", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "170", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "171", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "172", "colour": "orange", "code": "    if scheme:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "173", "colour": "orange", "code": "        s = request.headers.get(scheme, None)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "174", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "175", "colour": "orange", "code": "            cherrypy.log('Testing scheme %r:%r' % (scheme, s), 'TOOLS.PROXY')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "176", "colour": "orange", "code": "        if s == 'on' and 'ssl' in scheme.lower():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "177", "colour": "orange", "code": "            # This handles e.g. webfaction's 'X-Forwarded-Ssl: on' header\n", "error": "none", "author": "tom@organisms.be"}, {"index": "178", "colour": "orange", "code": "            scheme = 'https'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "179", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "180", "colour": "orange", "code": "            # This is for lighttpd/pound/Mongrel's 'X-Forwarded-Proto: https'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "181", "colour": "orange", "code": "            scheme = s\n", "error": "none", "author": "tom@organisms.be"}, {"index": "182", "colour": "orange", "code": "    if not scheme:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "183", "colour": "orange", "code": "        scheme = request.base[:request.base.find(\"://\")]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "184", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "185", "colour": "orange", "code": "    if local:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "186", "colour": "orange", "code": "        lbase = request.headers.get(local, None)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "187", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "188", "colour": "orange", "code": "            cherrypy.log('Testing local %r:%r' % (local, lbase), 'TOOLS.PROXY')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "189", "colour": "orange", "code": "        if lbase is not None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "190", "colour": "orange", "code": "            base = lbase.split(',')[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "191", "colour": "orange", "code": "    if not base:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "192", "colour": "orange", "code": "        port = request.local.port\n", "error": "none", "author": "tom@organisms.be"}, {"index": "193", "colour": "orange", "code": "        if port == 80:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "194", "colour": "orange", "code": "            base = '127.0.0.1'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "195", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "196", "colour": "orange", "code": "            base = '127.0.0.1:%s' % port\n", "error": "none", "author": "tom@organisms.be"}, {"index": "197", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "198", "colour": "orange", "code": "    if base.find(\"://\") == -1:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "199", "colour": "orange", "code": "        # add http:// or https:// if needed\n", "error": "none", "author": "tom@organisms.be"}, {"index": "200", "colour": "orange", "code": "        base = scheme + \"://\" + base\n", "error": "none", "author": "tom@organisms.be"}, {"index": "201", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "202", "colour": "orange", "code": "    request.base = base\n", "error": "none", "author": "tom@organisms.be"}, {"index": "203", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "204", "colour": "orange", "code": "    if remote:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "205", "colour": "orange", "code": "        xff = request.headers.get(remote)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "206", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "207", "colour": "orange", "code": "            cherrypy.log('Testing remote %r:%r' % (remote, xff), 'TOOLS.PROXY')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "208", "colour": "orange", "code": "        if xff:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "209", "colour": "orange", "code": "            if remote == 'X-Forwarded-For':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "210", "colour": "orange", "code": "                # See http://bob.pythonmac.org/archives/2005/09/23/apache-x-forwarded-for-caveat/\n", "error": "none", "author": "tom@organisms.be"}, {"index": "211", "colour": "orange", "code": "                xff = xff.split(',')[-1].strip()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "212", "colour": "orange", "code": "            request.remote.ip = xff\n", "error": "none", "author": "tom@organisms.be"}, {"index": "213", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "214", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "215", "colour": "orange", "code": "def ignore_headers(headers=('Range',), debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "216", "colour": "orange", "code": "    \"\"\"Delete request headers whose field names are included in 'headers'.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "217", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "218", "colour": "orange", "code": "    This is a useful tool for working behind certain HTTP servers;\n", "error": "none", "author": "tom@organisms.be"}, {"index": "219", "colour": "orange", "code": "    for example, Apache duplicates the work that CP does for 'Range'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "220", "colour": "orange", "code": "    headers, and will doubly-truncate the response.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "221", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "222", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "223", "colour": "orange", "code": "    for name in headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "224", "colour": "orange", "code": "        if name in request.headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "225", "colour": "orange", "code": "            if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "226", "colour": "orange", "code": "                cherrypy.log('Ignoring request header %r' % name,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "227", "colour": "orange", "code": "                             'TOOLS.IGNORE_HEADERS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "228", "colour": "orange", "code": "            del request.headers[name]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "229", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "230", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "231", "colour": "orange", "code": "def response_headers(headers=None, debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "232", "colour": "orange", "code": "    \"\"\"Set headers on the response.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "233", "colour": "orange", "code": "    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "234", "colour": "orange", "code": "        cherrypy.log('Setting response headers: %s' % repr(headers),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "235", "colour": "orange", "code": "                     'TOOLS.RESPONSE_HEADERS')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "236", "colour": "orange", "code": "    for name, value in (headers or []):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "237", "colour": "orange", "code": "        cherrypy.serving.response.headers[name] = value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "238", "colour": "orange", "code": "response_headers.failsafe = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "239", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "240", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "241", "colour": "blue", "code": "def referer(pattern, accept=True, accept_missing=False, error=403,\n", "error": "R", "author": "tom@organisms.be"}, {"index": "242", "colour": "orange", "code": "            message='Forbidden Referer header.', debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "243", "colour": "orange", "code": "    \"\"\"Raise HTTPError if Referer header does/does not match the given pattern.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "244", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "245", "colour": "orange", "code": "    pattern\n", "error": "none", "author": "tom@organisms.be"}, {"index": "246", "colour": "orange", "code": "        A regular expression pattern to test against the Referer.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "247", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "248", "colour": "orange", "code": "    accept\n", "error": "none", "author": "tom@organisms.be"}, {"index": "249", "colour": "orange", "code": "        If True, the Referer must match the pattern; if False,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "250", "colour": "orange", "code": "        the Referer must NOT match the pattern.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "251", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "252", "colour": "orange", "code": "    accept_missing\n", "error": "none", "author": "tom@organisms.be"}, {"index": "253", "colour": "orange", "code": "        If True, permit requests with no Referer header.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "254", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "255", "colour": "orange", "code": "    error\n", "error": "none", "author": "tom@organisms.be"}, {"index": "256", "colour": "orange", "code": "        The HTTP error code to return to the client on failure.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "257", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "258", "colour": "orange", "code": "    message\n", "error": "none", "author": "tom@organisms.be"}, {"index": "259", "colour": "orange", "code": "        A string to include in the response body on failure.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "260", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "261", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "262", "colour": "orange", "code": "    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "263", "colour": "orange", "code": "        ref = cherrypy.serving.request.headers['Referer']\n", "error": "none", "author": "tom@organisms.be"}, {"index": "264", "colour": "orange", "code": "        match = bool(re.match(pattern, ref))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "265", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "266", "colour": "orange", "code": "            cherrypy.log('Referer %r matches %r' % (ref, pattern),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "267", "colour": "orange", "code": "                         'TOOLS.REFERER')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "268", "colour": "orange", "code": "        if accept == match:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "269", "colour": "orange", "code": "            return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "270", "colour": "orange", "code": "    except KeyError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "271", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "272", "colour": "orange", "code": "            cherrypy.log('No Referer header', 'TOOLS.REFERER')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "273", "colour": "orange", "code": "        if accept_missing:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "274", "colour": "orange", "code": "            return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "275", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "276", "colour": "orange", "code": "    raise cherrypy.HTTPError(error, message)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "277", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "278", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "279", "colour": "orange", "code": "class SessionAuth(object):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "280", "colour": "orange", "code": "    \"\"\"Assert that the user is logged in.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "281", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "282", "colour": "orange", "code": "    session_key = \"username\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "283", "colour": "orange", "code": "    debug = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "284", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "285", "colour": "orange", "code": "    def check_username_and_password(self, username, password):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "286", "colour": "orange", "code": "        pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "287", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "288", "colour": "orange", "code": "    def anonymous(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "289", "colour": "orange", "code": "        \"\"\"Provide a temporary user name for anonymous users.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "290", "colour": "orange", "code": "        pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "291", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "292", "colour": "orange", "code": "    def on_login(self, username):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "293", "colour": "orange", "code": "        pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "294", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "295", "colour": "orange", "code": "    def on_logout(self, username):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "296", "colour": "orange", "code": "        pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "297", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "298", "colour": "orange", "code": "    def on_check(self, username):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "299", "colour": "orange", "code": "        pass\n", "error": "none", "author": "tom@organisms.be"}, {"index": "300", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "301", "colour": "blue", "code": "    def login_screen(self, from_page='..', username='', error_msg='', **kwargs):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "302", "colour": "orange", "code": "        return (unicodestr(\"\"\"<html><body>\n", "error": "none", "author": "tom@organisms.be"}, {"index": "303", "colour": "orange", "code": "Message: %(error_msg)s\n", "error": "none", "author": "tom@organisms.be"}, {"index": "304", "colour": "orange", "code": "<form method=\"post\" action=\"do_login\">\n", "error": "none", "author": "tom@organisms.be"}, {"index": "305", "colour": "orange", "code": "    Login: <input type=\"text\" name=\"username\" value=\"%(username)s\" size=\"10\" /><br />\n", "error": "none", "author": "tom@organisms.be"}, {"index": "306", "colour": "orange", "code": "    Password: <input type=\"password\" name=\"password\" size=\"10\" /><br />\n", "error": "none", "author": "tom@organisms.be"}, {"index": "307", "colour": "orange", "code": "    <input type=\"hidden\" name=\"from_page\" value=\"%(from_page)s\" /><br />\n", "error": "none", "author": "tom@organisms.be"}, {"index": "308", "colour": "orange", "code": "    <input type=\"submit\" />\n", "error": "none", "author": "tom@organisms.be"}, {"index": "309", "colour": "orange", "code": "</form>\n", "error": "none", "author": "tom@organisms.be"}, {"index": "310", "colour": "orange", "code": "</body></html>\"\"\") % vars()).encode(\"utf-8\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "311", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "312", "colour": "green", "code": "    def do_login(self, username, password, from_page='..', **kwargs):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "313", "colour": "orange", "code": "        \"\"\"Login. May raise redirect, or return True if request handled.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "314", "colour": "orange", "code": "        response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "315", "colour": "orange", "code": "        error_msg = self.check_username_and_password(username, password)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "316", "colour": "orange", "code": "        if error_msg:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "317", "colour": "orange", "code": "            body = self.login_screen(from_page, username, error_msg)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "318", "colour": "orange", "code": "            response.body = body\n", "error": "none", "author": "tom@organisms.be"}, {"index": "319", "colour": "orange", "code": "            if \"Content-Length\" in response.headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "320", "colour": "orange", "code": "                # Delete Content-Length header so finalize() recalcs it.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "321", "colour": "orange", "code": "                del response.headers[\"Content-Length\"]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "322", "colour": "orange", "code": "            return True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "323", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "324", "colour": "orange", "code": "            cherrypy.serving.request.login = username\n", "error": "none", "author": "tom@organisms.be"}, {"index": "325", "colour": "red", "code": "            cherrypy.session[self.session_key] = username\n", "error": "E", "author": "tom@organisms.be"}, {"index": "326", "colour": "orange", "code": "            self.on_login(username)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "327", "colour": "orange", "code": "            raise cherrypy.HTTPRedirect(from_page or \"/\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "328", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "329", "colour": "green", "code": "    def do_logout(self, from_page='..', **kwargs):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "330", "colour": "orange", "code": "        \"\"\"Logout. May raise redirect, or return True if request handled.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "331", "colour": "red", "code": "        sess = cherrypy.session\n", "error": "E", "author": "tom@organisms.be"}, {"index": "332", "colour": "orange", "code": "        username = sess.get(self.session_key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "333", "colour": "orange", "code": "        sess[self.session_key] = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "334", "colour": "orange", "code": "        if username:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "335", "colour": "orange", "code": "            cherrypy.serving.request.login = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "336", "colour": "orange", "code": "            self.on_logout(username)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "337", "colour": "orange", "code": "        raise cherrypy.HTTPRedirect(from_page)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "338", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "339", "colour": "orange", "code": "    def do_check(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "340", "colour": "orange", "code": "        \"\"\"Assert username. May raise redirect, or return True if request handled.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "341", "colour": "red", "code": "        sess = cherrypy.session\n", "error": "E", "author": "tom@organisms.be"}, {"index": "342", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "343", "colour": "orange", "code": "        response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "344", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "345", "colour": "orange", "code": "        username = sess.get(self.session_key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "346", "colour": "orange", "code": "        if not username:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "347", "colour": "orange", "code": "            sess[self.session_key] = username = self.anonymous()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "348", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "349", "colour": "orange", "code": "                cherrypy.log('No session[username], trying anonymous', 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "350", "colour": "orange", "code": "        if not username:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "351", "colour": "orange", "code": "            url = cherrypy.url(qs=request.query_string)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "352", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "353", "colour": "orange", "code": "                cherrypy.log('No username, routing to login_screen with '\n", "error": "none", "author": "tom@organisms.be"}, {"index": "354", "colour": "orange", "code": "                             'from_page %r' % url, 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "355", "colour": "orange", "code": "            response.body = self.login_screen(url)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "356", "colour": "orange", "code": "            if \"Content-Length\" in response.headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "357", "colour": "orange", "code": "                # Delete Content-Length header so finalize() recalcs it.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "358", "colour": "orange", "code": "                del response.headers[\"Content-Length\"]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "359", "colour": "orange", "code": "            return True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "360", "colour": "orange", "code": "        if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "361", "colour": "orange", "code": "            cherrypy.log('Setting request.login to %r' % username, 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "362", "colour": "orange", "code": "        request.login = username\n", "error": "none", "author": "tom@organisms.be"}, {"index": "363", "colour": "orange", "code": "        self.on_check(username)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "364", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "365", "colour": "orange", "code": "    def run(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "366", "colour": "orange", "code": "        request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "367", "colour": "orange", "code": "        response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "368", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "369", "colour": "orange", "code": "        path = request.path_info\n", "error": "none", "author": "tom@organisms.be"}, {"index": "370", "colour": "orange", "code": "        if path.endswith('login_screen'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "371", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "372", "colour": "orange", "code": "                cherrypy.log('routing %r to login_screen' % path, 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "373", "colour": "orange", "code": "            return self.login_screen(**request.params)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "374", "colour": "orange", "code": "        elif path.endswith('do_login'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "375", "colour": "orange", "code": "            if request.method != 'POST':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "376", "colour": "orange", "code": "                response.headers['Allow'] = \"POST\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "377", "colour": "orange", "code": "                if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "378", "colour": "orange", "code": "                    cherrypy.log('do_login requires POST', 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "379", "colour": "orange", "code": "                raise cherrypy.HTTPError(405)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "380", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "381", "colour": "orange", "code": "                cherrypy.log('routing %r to do_login' % path, 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "382", "colour": "orange", "code": "            return self.do_login(**request.params)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "383", "colour": "orange", "code": "        elif path.endswith('do_logout'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "384", "colour": "orange", "code": "            if request.method != 'POST':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "385", "colour": "orange", "code": "                response.headers['Allow'] = \"POST\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "386", "colour": "orange", "code": "                raise cherrypy.HTTPError(405)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "387", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "388", "colour": "orange", "code": "                cherrypy.log('routing %r to do_logout' % path, 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "389", "colour": "orange", "code": "            return self.do_logout(**request.params)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "390", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "391", "colour": "orange", "code": "            if self.debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "392", "colour": "orange", "code": "                cherrypy.log('No special path, running do_check', 'TOOLS.SESSAUTH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "393", "colour": "orange", "code": "            return self.do_check()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "394", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "395", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "396", "colour": "orange", "code": "def session_auth(**kwargs):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "397", "colour": "orange", "code": "    sa = SessionAuth()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "398", "colour": "green", "code": "    for k, v in kwargs.items():\n", "error": "W", "author": "tom@organisms.be"}, {"index": "399", "colour": "orange", "code": "        setattr(sa, k, v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "400", "colour": "orange", "code": "    return sa.run()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "401", "colour": "orange", "code": "session_auth.__doc__ = \"\"\"Session authentication hook.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "402", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "403", "colour": "orange", "code": "Any attribute of the SessionAuth class may be overridden via a keyword arg\n", "error": "none", "author": "tom@organisms.be"}, {"index": "404", "colour": "orange", "code": "to this function:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "405", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "406", "colour": "orange", "code": "\"\"\" + \"\\n\".join([\"%s: %s\" % (k, type(getattr(SessionAuth, k)).__name__)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "407", "colour": "orange", "code": "                 for k in dir(SessionAuth) if not k.startswith(\"__\")])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "408", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "409", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "410", "colour": "green", "code": "def log_traceback(severity=logging.ERROR, debug=False):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "411", "colour": "orange", "code": "    \"\"\"Write the last error's traceback to the cherrypy error log.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "412", "colour": "orange", "code": "    cherrypy.log(\"\", \"HTTP\", severity=severity, traceback=True)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "413", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "414", "colour": "green", "code": "def log_request_headers(debug=False):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "415", "colour": "orange", "code": "    \"\"\"Write request headers to the cherrypy error log.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "416", "colour": "green", "code": "    h = [\"  %s: %s\" % (k, v) for k, v in cherrypy.serving.request.header_list]\n", "error": "W", "author": "tom@organisms.be"}, {"index": "417", "colour": "orange", "code": "    cherrypy.log('\\nRequest Headers:\\n' + '\\n'.join(h), \"HTTP\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "418", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "419", "colour": "green", "code": "def log_hooks(debug=False):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "420", "colour": "orange", "code": "    \"\"\"Write request.hooks to the cherrypy error log.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "421", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "422", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "423", "colour": "orange", "code": "    msg = []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "424", "colour": "orange", "code": "    # Sort by the standard points if possible.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "425", "colour": "orange", "code": "    from cherrypy import _cprequest\n", "error": "none", "author": "tom@organisms.be"}, {"index": "426", "colour": "orange", "code": "    points = _cprequest.hookpoints\n", "error": "none", "author": "tom@organisms.be"}, {"index": "427", "colour": "green", "code": "    for k in request.hooks.keys():\n", "error": "W", "author": "tom@organisms.be"}, {"index": "428", "colour": "orange", "code": "        if k not in points:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "429", "colour": "orange", "code": "            points.append(k)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "430", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "431", "colour": "orange", "code": "    for k in points:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "432", "colour": "orange", "code": "        msg.append(\"    %s:\" % k)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "433", "colour": "orange", "code": "        v = request.hooks.get(k, [])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "434", "colour": "orange", "code": "        v.sort()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "435", "colour": "orange", "code": "        for h in v:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "436", "colour": "orange", "code": "            msg.append(\"        %r\" % h)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "437", "colour": "orange", "code": "    cherrypy.log('\\nRequest Hooks for ' + cherrypy.url() +\n", "error": "none", "author": "tom@organisms.be"}, {"index": "438", "colour": "orange", "code": "                 ':\\n' + '\\n'.join(msg), \"HTTP\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "439", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "440", "colour": "orange", "code": "def redirect(url='', internal=True, debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "441", "colour": "orange", "code": "    \"\"\"Raise InternalRedirect or HTTPRedirect to the given url.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "442", "colour": "orange", "code": "    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "443", "colour": "orange", "code": "        cherrypy.log('Redirecting %sto: %s' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "444", "colour": "orange", "code": "                     ({True: 'internal ', False: ''}[internal], url),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "445", "colour": "orange", "code": "                     'TOOLS.REDIRECT')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "446", "colour": "orange", "code": "    if internal:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "447", "colour": "orange", "code": "        raise cherrypy.InternalRedirect(url)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "448", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "449", "colour": "orange", "code": "        raise cherrypy.HTTPRedirect(url)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "450", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "451", "colour": "orange", "code": "def trailing_slash(missing=True, extra=False, status=None, debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "452", "colour": "orange", "code": "    \"\"\"Redirect if path_info has (missing|extra) trailing slash.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "453", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "454", "colour": "orange", "code": "    pi = request.path_info\n", "error": "none", "author": "tom@organisms.be"}, {"index": "455", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "456", "colour": "orange", "code": "    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "457", "colour": "orange", "code": "        cherrypy.log('is_index: %r, missing: %r, extra: %r, path_info: %r' %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "458", "colour": "orange", "code": "                     (request.is_index, missing, extra, pi),\n", "error": "none", "author": "tom@organisms.be"}, {"index": "459", "colour": "orange", "code": "                     'TOOLS.TRAILING_SLASH')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "460", "colour": "orange", "code": "    if request.is_index is True:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "461", "colour": "orange", "code": "        if missing:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "462", "colour": "orange", "code": "            if not pi.endswith('/'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "463", "colour": "orange", "code": "                new_url = cherrypy.url(pi + '/', request.query_string)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "464", "colour": "orange", "code": "                raise cherrypy.HTTPRedirect(new_url, status=status or 301)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "465", "colour": "orange", "code": "    elif request.is_index is False:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "466", "colour": "orange", "code": "        if extra:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "467", "colour": "orange", "code": "            # If pi == '/', don't redirect to ''!\n", "error": "none", "author": "tom@organisms.be"}, {"index": "468", "colour": "orange", "code": "            if pi.endswith('/') and pi != '/':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "469", "colour": "orange", "code": "                new_url = cherrypy.url(pi[:-1], request.query_string)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "470", "colour": "orange", "code": "                raise cherrypy.HTTPRedirect(new_url, status=status or 301)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "471", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "472", "colour": "orange", "code": "def flatten(debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "473", "colour": "orange", "code": "    \"\"\"Wrap response.body in a generator that recursively iterates over body.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "474", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "475", "colour": "orange", "code": "    This allows cherrypy.response.body to consist of 'nested generators';\n", "error": "none", "author": "tom@organisms.be"}, {"index": "476", "colour": "orange", "code": "    that is, a set of generators that yield generators.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "477", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "478", "colour": "orange", "code": "    import types\n", "error": "none", "author": "tom@organisms.be"}, {"index": "479", "colour": "green", "code": "    def flattener(input):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "480", "colour": "orange", "code": "        numchunks = 0\n", "error": "none", "author": "tom@organisms.be"}, {"index": "481", "colour": "orange", "code": "        for x in input:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "482", "colour": "orange", "code": "            if not isinstance(x, types.GeneratorType):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "483", "colour": "orange", "code": "                numchunks += 1\n", "error": "none", "author": "tom@organisms.be"}, {"index": "484", "colour": "orange", "code": "                yield x\n", "error": "none", "author": "tom@organisms.be"}, {"index": "485", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "486", "colour": "orange", "code": "                for y in flattener(x):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "487", "colour": "orange", "code": "                    numchunks += 1\n", "error": "none", "author": "tom@organisms.be"}, {"index": "488", "colour": "orange", "code": "                    yield y\n", "error": "none", "author": "tom@organisms.be"}, {"index": "489", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "490", "colour": "orange", "code": "            cherrypy.log('Flattened %d chunks' % numchunks, 'TOOLS.FLATTEN')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "491", "colour": "orange", "code": "    response = cherrypy.serving.response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "492", "colour": "orange", "code": "    response.body = flattener(response.body)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "493", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "494", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "495", "colour": "blue", "code": "def accept(media=None, debug=False):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "496", "colour": "orange", "code": "    \"\"\"Return the client's preferred media-type (from the given Content-Types).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "497", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "498", "colour": "orange", "code": "    If 'media' is None (the default), no test will be performed.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "499", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "500", "colour": "orange", "code": "    If 'media' is provided, it should be the Content-Type value (as a string)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "501", "colour": "orange", "code": "    or values (as a list or tuple of strings) which the current resource\n", "error": "none", "author": "tom@organisms.be"}, {"index": "502", "colour": "orange", "code": "    can emit. The client's acceptable media ranges (as declared in the\n", "error": "none", "author": "tom@organisms.be"}, {"index": "503", "colour": "orange", "code": "    Accept request header) will be matched in order to these Content-Type\n", "error": "none", "author": "tom@organisms.be"}, {"index": "504", "colour": "orange", "code": "    values; the first such string is returned. That is, the return value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "505", "colour": "orange", "code": "    will always be one of the strings provided in the 'media' arg (or None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "506", "colour": "orange", "code": "    if 'media' is None).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "507", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "508", "colour": "orange", "code": "    If no match is found, then HTTPError 406 (Not Acceptable) is raised.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "509", "colour": "orange", "code": "    Note that most web browsers send */* as a (low-quality) acceptable\n", "error": "none", "author": "tom@organisms.be"}, {"index": "510", "colour": "orange", "code": "    media range, which should match any Content-Type. In addition, \"...if\n", "error": "none", "author": "tom@organisms.be"}, {"index": "511", "colour": "orange", "code": "    no Accept header field is present, then it is assumed that the client\n", "error": "none", "author": "tom@organisms.be"}, {"index": "512", "colour": "orange", "code": "    accepts all media types.\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "513", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "514", "colour": "orange", "code": "    Matching types are checked in order of client preference first,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "515", "colour": "orange", "code": "    and then in the order of the given 'media' values.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "516", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "517", "colour": "orange", "code": "    Note that this function does not honor accept-params (other than \"q\").\n", "error": "none", "author": "tom@organisms.be"}, {"index": "518", "colour": "orange", "code": "    \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "519", "colour": "orange", "code": "    if not media:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "520", "colour": "orange", "code": "        return\n", "error": "none", "author": "tom@organisms.be"}, {"index": "521", "colour": "orange", "code": "    if isinstance(media, basestring):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "522", "colour": "orange", "code": "        media = [media]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "523", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "524", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "525", "colour": "orange", "code": "    # Parse the Accept request header, and try to match one\n", "error": "none", "author": "tom@organisms.be"}, {"index": "526", "colour": "orange", "code": "    # of the requested media-ranges (in order of preference).\n", "error": "none", "author": "tom@organisms.be"}, {"index": "527", "colour": "orange", "code": "    ranges = request.headers.elements('Accept')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "528", "colour": "orange", "code": "    if not ranges:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "529", "colour": "orange", "code": "        # Any media type is acceptable.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "530", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "531", "colour": "orange", "code": "            cherrypy.log('No Accept header elements', 'TOOLS.ACCEPT')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "532", "colour": "orange", "code": "        return media[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "533", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "534", "colour": "orange", "code": "        # Note that 'ranges' is sorted in order of preference\n", "error": "none", "author": "tom@organisms.be"}, {"index": "535", "colour": "orange", "code": "        for element in ranges:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "536", "colour": "orange", "code": "            if element.qvalue > 0:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "537", "colour": "orange", "code": "                if element.value == \"*/*\":\n", "error": "none", "author": "tom@organisms.be"}, {"index": "538", "colour": "orange", "code": "                    # Matches any type or subtype\n", "error": "none", "author": "tom@organisms.be"}, {"index": "539", "colour": "orange", "code": "                    if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "540", "colour": "orange", "code": "                        cherrypy.log('Match due to */*', 'TOOLS.ACCEPT')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "541", "colour": "orange", "code": "                    return media[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "542", "colour": "orange", "code": "                elif element.value.endswith(\"/*\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "543", "colour": "orange", "code": "                    # Matches any subtype\n", "error": "none", "author": "tom@organisms.be"}, {"index": "544", "colour": "orange", "code": "                    mtype = element.value[:-1]  # Keep the slash\n", "error": "none", "author": "tom@organisms.be"}, {"index": "545", "colour": "orange", "code": "                    for m in media:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "546", "colour": "orange", "code": "                        if m.startswith(mtype):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "547", "colour": "orange", "code": "                            if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "548", "colour": "orange", "code": "                                cherrypy.log('Match due to %s' % element.value,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "549", "colour": "orange", "code": "                                             'TOOLS.ACCEPT')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "550", "colour": "orange", "code": "                            return m\n", "error": "none", "author": "tom@organisms.be"}, {"index": "551", "colour": "orange", "code": "                else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "552", "colour": "orange", "code": "                    # Matches exact value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "553", "colour": "orange", "code": "                    if element.value in media:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "554", "colour": "orange", "code": "                        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "555", "colour": "orange", "code": "                            cherrypy.log('Match due to %s' % element.value,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "556", "colour": "orange", "code": "                                         'TOOLS.ACCEPT')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "557", "colour": "orange", "code": "                        return element.value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "558", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "559", "colour": "orange", "code": "    # No suitable media-range found.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "560", "colour": "orange", "code": "    ah = request.headers.get('Accept')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "561", "colour": "orange", "code": "    if ah is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "562", "colour": "orange", "code": "        msg = \"Your client did not send an Accept header.\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "563", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "564", "colour": "orange", "code": "        msg = \"Your client sent this Accept header: %s.\" % ah\n", "error": "none", "author": "tom@organisms.be"}, {"index": "565", "colour": "orange", "code": "    msg += (\" But this resource only emits these media types: %s.\" %\n", "error": "none", "author": "tom@organisms.be"}, {"index": "566", "colour": "orange", "code": "            \", \".join(media))\n", "error": "none", "author": "tom@organisms.be"}, {"index": "567", "colour": "orange", "code": "    raise cherrypy.HTTPError(406, msg)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "568", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "569", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "570", "colour": "blue", "code": "class MonitoredHeaderMap(_httputil.HeaderMap):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "571", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "572", "colour": "green", "code": "    def __init__(self):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "573", "colour": "orange", "code": "        self.accessed_headers = set()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "574", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "575", "colour": "orange", "code": "    def __getitem__(self, key):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "576", "colour": "orange", "code": "        self.accessed_headers.add(key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "577", "colour": "orange", "code": "        return _httputil.HeaderMap.__getitem__(self, key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "578", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "579", "colour": "orange", "code": "    def __contains__(self, key):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "580", "colour": "orange", "code": "        self.accessed_headers.add(key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "581", "colour": "orange", "code": "        return _httputil.HeaderMap.__contains__(self, key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "582", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "583", "colour": "orange", "code": "    def get(self, key, default=None):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "584", "colour": "orange", "code": "        self.accessed_headers.add(key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "585", "colour": "orange", "code": "        return _httputil.HeaderMap.get(self, key, default=default)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "586", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "587", "colour": "orange", "code": "    if hasattr({}, 'has_key'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "588", "colour": "orange", "code": "        # Python 2\n", "error": "none", "author": "tom@organisms.be"}, {"index": "589", "colour": "orange", "code": "        def has_key(self, key):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "590", "colour": "orange", "code": "            self.accessed_headers.add(key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "591", "colour": "orange", "code": "            return _httputil.HeaderMap.has_key(self, key)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "592", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "593", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "594", "colour": "orange", "code": "def autovary(ignore=None, debug=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "595", "colour": "orange", "code": "    \"\"\"Auto-populate the Vary response header based on request.header access.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "596", "colour": "orange", "code": "    request = cherrypy.serving.request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "597", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "598", "colour": "orange", "code": "    req_h = request.headers\n", "error": "none", "author": "tom@organisms.be"}, {"index": "599", "colour": "orange", "code": "    request.headers = MonitoredHeaderMap()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "600", "colour": "orange", "code": "    request.headers.update(req_h)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "601", "colour": "orange", "code": "    if ignore is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "602", "colour": "orange", "code": "        ignore = set(['Content-Disposition', 'Content-Length', 'Content-Type'])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "603", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "604", "colour": "orange", "code": "    def set_response_header():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "605", "colour": "orange", "code": "        resp_h = cherrypy.serving.response.headers\n", "error": "none", "author": "tom@organisms.be"}, {"index": "606", "colour": "orange", "code": "        v = set([e.value for e in resp_h.elements('Vary')])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "607", "colour": "orange", "code": "        if debug:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "608", "colour": "orange", "code": "            cherrypy.log('Accessed headers: %s' % request.headers.accessed_headers,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "609", "colour": "orange", "code": "                         'TOOLS.AUTOVARY')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "610", "colour": "orange", "code": "        v = v.union(request.headers.accessed_headers)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "611", "colour": "orange", "code": "        v = v.difference(ignore)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "612", "colour": "orange", "code": "        v = list(v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "613", "colour": "orange", "code": "        v.sort()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "614", "colour": "orange", "code": "        resp_h['Vary'] = ', '.join(v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "615", "colour": "orange", "code": "    request.hooks.attach('before_finalize', set_response_header, 95)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "616", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}]]}