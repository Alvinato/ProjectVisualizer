{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/_cpmodpy.py", "lines": [[{"index": "1", "colour": "orange", "code": "\"\"\"Native adapter for serving CherryPy via mod_python\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "3", "colour": "orange", "code": "Basic usage:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "4", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "5", "colour": "orange", "code": "##########################################\n", "error": "none", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "# Application in a module called myapp.py\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "orange", "code": "##########################################\n", "error": "none", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "import cherrypy\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "class Root:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "    @cherrypy.expose\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "orange", "code": "    def index(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "        return 'Hi there, Ho there, Hey there'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "# We will use this method from the mod_python configuration\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "# as the entry point to our application\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "def setup_server():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "    cherrypy.tree.mount(Root())\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "    cherrypy.config.update({'environment': 'production',\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "orange", "code": "                            'log.screen': False,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "                            'show_tracebacks': False})\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "##########################################\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "# mod_python settings for apache2\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "# This should reside in your httpd.conf\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "# or a file that will be loaded at\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "orange", "code": "# apache startup\n", "error": "none", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "##########################################\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "# Start\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "orange", "code": "DocumentRoot \"/\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "Listen 8080\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "orange", "code": "LoadModule python_module /usr/lib/apache2/modules/mod_python.so\n", "error": "none", "author": "tom@organisms.be"}, {"index": "36", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "<Location \"/\">\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "orange", "code": "\tPythonPath \"sys.path+['/path/to/my/application']\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "\tSetHandler python-program\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "orange", "code": "\tPythonHandler cherrypy._cpmodpy::handler\n", "error": "none", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "\tPythonOption cherrypy.setup myapp::setup_server\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "orange", "code": "\tPythonDebug On\n", "error": "none", "author": "tom@organisms.be"}, {"index": "43", "colour": "orange", "code": "</Location>\n", "error": "none", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "# End\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "The actual path to your mod_python.so is dependent on your\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "orange", "code": "environment. In this case we suppose a global mod_python\n", "error": "none", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "installation on a Linux distribution such as Ubuntu.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "We do set the PythonPath configuration setting so that\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "your application can be found by from the user running\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "the apache2 instance. Of course if your application\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "resides in the global site-package this won't be needed.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "Then restart apache2 and access http://127.0.0.1:8080\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "import logging\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "import sys\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "import cherrypy\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "from cherrypy._cpcompat import BytesIO, copyitems, ntob\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "from cherrypy._cperror import format_exc, bare_error\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "from cherrypy.lib import httputil\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "# ------------------------------ Request-handling\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "orange", "code": "def setup(req):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "72", "colour": "orange", "code": "    from mod_python import apache\n", "error": "none", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "    # Run any setup functions defined by a \"PythonOption cherrypy.setup\" directive.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "orange", "code": "    options = req.get_options()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "    if 'cherrypy.setup' in options:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "        for function in options['cherrypy.setup'].split():\n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "orange", "code": "            atoms = function.split('::', 1)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "            if len(atoms) == 1:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "                mod = __import__(atoms[0], globals(), locals())\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "                modname, fname = atoms\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "                mod = __import__(modname, globals(), locals(), [fname])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "                func = getattr(mod, fname)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "                func()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "orange", "code": "    cherrypy.config.update({'log.screen': False,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "                            \"tools.ignore_headers.on\": True,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "                            \"tools.ignore_headers.headers\": ['Range'],\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "orange", "code": "                            })\n", "error": "none", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "92", "colour": "orange", "code": "    engine = cherrypy.engine\n", "error": "none", "author": "tom@organisms.be"}, {"index": "93", "colour": "orange", "code": "    if hasattr(engine, \"signal_handler\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "94", "colour": "orange", "code": "        engine.signal_handler.unsubscribe()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "95", "colour": "orange", "code": "    if hasattr(engine, \"console_control_handler\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "96", "colour": "orange", "code": "        engine.console_control_handler.unsubscribe()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "97", "colour": "orange", "code": "    engine.autoreload.unsubscribe()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "98", "colour": "orange", "code": "    cherrypy.server.unsubscribe()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "99", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "100", "colour": "orange", "code": "    def _log(msg, level):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "101", "colour": "orange", "code": "        newlevel = apache.APLOG_ERR\n", "error": "none", "author": "tom@organisms.be"}, {"index": "102", "colour": "orange", "code": "        if logging.DEBUG >= level:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "103", "colour": "orange", "code": "            newlevel = apache.APLOG_DEBUG\n", "error": "none", "author": "tom@organisms.be"}, {"index": "104", "colour": "orange", "code": "        elif logging.INFO >= level:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "105", "colour": "orange", "code": "            newlevel = apache.APLOG_INFO\n", "error": "none", "author": "tom@organisms.be"}, {"index": "106", "colour": "orange", "code": "        elif logging.WARNING >= level:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "107", "colour": "orange", "code": "            newlevel = apache.APLOG_WARNING\n", "error": "none", "author": "tom@organisms.be"}, {"index": "108", "colour": "orange", "code": "        # On Windows, req.server is required or the msg will vanish. See\n", "error": "none", "author": "tom@organisms.be"}, {"index": "109", "colour": "orange", "code": "        # http://www.modpython.org/pipermail/mod_python/2003-October/014291.html.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "110", "colour": "orange", "code": "        # Also, \"When server is not specified...LogLevel does not apply...\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "111", "colour": "orange", "code": "        apache.log_error(msg, newlevel, req.server)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "112", "colour": "orange", "code": "    engine.subscribe('log', _log)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "113", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "114", "colour": "orange", "code": "    engine.start()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "115", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "116", "colour": "green", "code": "    def cherrypy_cleanup(data):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "117", "colour": "orange", "code": "        engine.exit()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "118", "colour": "orange", "code": "    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "119", "colour": "orange", "code": "        # apache.register_cleanup wasn't available until 3.1.4.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "120", "colour": "orange", "code": "        apache.register_cleanup(cherrypy_cleanup)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "121", "colour": "orange", "code": "    except AttributeError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "122", "colour": "orange", "code": "        req.server.register_cleanup(req, cherrypy_cleanup)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "123", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "124", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "125", "colour": "blue", "code": "class _ReadOnlyRequest:\n", "error": "R", "author": "tom@organisms.be"}, {"index": "126", "colour": "orange", "code": "    expose = ('read', 'readline', 'readlines')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "127", "colour": "orange", "code": "    def __init__(self, req):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "128", "colour": "orange", "code": "        for method in self.expose:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "129", "colour": "orange", "code": "            self.__dict__[method] = getattr(req, method)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "130", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "131", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "132", "colour": "orange", "code": "recursive = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "133", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "134", "colour": "orange", "code": "_isSetUp = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "135", "colour": "blue", "code": "def handler(req):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "136", "colour": "orange", "code": "    from mod_python import apache\n", "error": "none", "author": "tom@organisms.be"}, {"index": "137", "colour": "orange", "code": "    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "138", "colour": "green", "code": "        global _isSetUp\n", "error": "W", "author": "tom@organisms.be"}, {"index": "139", "colour": "orange", "code": "        if not _isSetUp:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "140", "colour": "orange", "code": "            setup(req)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "141", "colour": "orange", "code": "            _isSetUp = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "142", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "143", "colour": "orange", "code": "        # Obtain a Request object from CherryPy\n", "error": "none", "author": "tom@organisms.be"}, {"index": "144", "colour": "orange", "code": "        local = req.connection.local_addr\n", "error": "none", "author": "tom@organisms.be"}, {"index": "145", "colour": "orange", "code": "        local = httputil.Host(local[0], local[1], req.connection.local_host or \"\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "146", "colour": "orange", "code": "        remote = req.connection.remote_addr\n", "error": "none", "author": "tom@organisms.be"}, {"index": "147", "colour": "orange", "code": "        remote = httputil.Host(remote[0], remote[1], req.connection.remote_host or \"\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "148", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "149", "colour": "orange", "code": "        scheme = req.parsed_uri[0] or 'http'\n", "error": "none", "author": "tom@organisms.be"}, {"index": "150", "colour": "orange", "code": "        req.get_basic_auth_pw()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "151", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "152", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "153", "colour": "orange", "code": "            # apache.mpm_query only became available in mod_python 3.1\n", "error": "none", "author": "tom@organisms.be"}, {"index": "154", "colour": "orange", "code": "            q = apache.mpm_query\n", "error": "none", "author": "tom@organisms.be"}, {"index": "155", "colour": "orange", "code": "            threaded = q(apache.AP_MPMQ_IS_THREADED)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "156", "colour": "orange", "code": "            forked = q(apache.AP_MPMQ_IS_FORKED)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "157", "colour": "orange", "code": "        except AttributeError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "158", "colour": "orange", "code": "            bad_value = (\"You must provide a PythonOption '%s', \"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "159", "colour": "orange", "code": "                         \"either 'on' or 'off', when running a version \"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "160", "colour": "orange", "code": "                         \"of mod_python < 3.1\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "161", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "162", "colour": "red", "code": "            threaded = options.get('multithread', '').lower()\n", "error": "E", "author": "tom@organisms.be"}, {"index": "163", "colour": "orange", "code": "            if threaded == 'on':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "164", "colour": "orange", "code": "                threaded = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "165", "colour": "orange", "code": "            elif threaded == 'off':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "166", "colour": "orange", "code": "                threaded = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "167", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "168", "colour": "orange", "code": "                raise ValueError(bad_value % \"multithread\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "169", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "170", "colour": "red", "code": "            forked = options.get('multiprocess', '').lower()\n", "error": "E", "author": "tom@organisms.be"}, {"index": "171", "colour": "orange", "code": "            if forked == 'on':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "172", "colour": "orange", "code": "                forked = True\n", "error": "none", "author": "tom@organisms.be"}, {"index": "173", "colour": "orange", "code": "            elif forked == 'off':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "174", "colour": "orange", "code": "                forked = False\n", "error": "none", "author": "tom@organisms.be"}, {"index": "175", "colour": "orange", "code": "            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "176", "colour": "orange", "code": "                raise ValueError(bad_value % \"multiprocess\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "177", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "178", "colour": "orange", "code": "        sn = cherrypy.tree.script_name(req.uri or \"/\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "179", "colour": "orange", "code": "        if sn is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "180", "colour": "orange", "code": "            send_response(req, '404 Not Found', [], '')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "181", "colour": "orange", "code": "        else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "182", "colour": "orange", "code": "            app = cherrypy.tree.apps[sn]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "183", "colour": "orange", "code": "            method = req.method\n", "error": "none", "author": "tom@organisms.be"}, {"index": "184", "colour": "orange", "code": "            path = req.uri\n", "error": "none", "author": "tom@organisms.be"}, {"index": "185", "colour": "orange", "code": "            qs = req.args or \"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "186", "colour": "orange", "code": "            reqproto = req.protocol\n", "error": "none", "author": "tom@organisms.be"}, {"index": "187", "colour": "orange", "code": "            headers = copyitems(req.headers_in)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "188", "colour": "orange", "code": "            rfile = _ReadOnlyRequest(req)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "189", "colour": "orange", "code": "            prev = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "190", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "191", "colour": "orange", "code": "            try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "192", "colour": "orange", "code": "                redirections = []\n", "error": "none", "author": "tom@organisms.be"}, {"index": "193", "colour": "orange", "code": "                while True:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "194", "colour": "orange", "code": "                    request, response = app.get_serving(local, remote, scheme,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "195", "colour": "orange", "code": "                                                        \"HTTP/1.1\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "196", "colour": "orange", "code": "                    request.login = req.user\n", "error": "none", "author": "tom@organisms.be"}, {"index": "197", "colour": "orange", "code": "                    request.multithread = bool(threaded)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "198", "colour": "orange", "code": "                    request.multiprocess = bool(forked)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "199", "colour": "orange", "code": "                    request.app = app\n", "error": "none", "author": "tom@organisms.be"}, {"index": "200", "colour": "orange", "code": "                    request.prev = prev\n", "error": "none", "author": "tom@organisms.be"}, {"index": "201", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "202", "colour": "orange", "code": "                    # Run the CherryPy Request object and obtain the response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "203", "colour": "orange", "code": "                    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "204", "colour": "orange", "code": "                        request.run(method, path, qs, reqproto, headers, rfile)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "205", "colour": "orange", "code": "                        break\n", "error": "none", "author": "tom@organisms.be"}, {"index": "206", "colour": "orange", "code": "                    except cherrypy.InternalRedirect:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "207", "colour": "orange", "code": "                        ir = sys.exc_info()[1]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "208", "colour": "orange", "code": "                        app.release_serving()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "209", "colour": "orange", "code": "                        prev = request\n", "error": "none", "author": "tom@organisms.be"}, {"index": "210", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "211", "colour": "orange", "code": "                        if not recursive:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "212", "colour": "orange", "code": "                            if ir.path in redirections:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "213", "colour": "orange", "code": "                                raise RuntimeError(\"InternalRedirector visited the \"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "214", "colour": "orange", "code": "                                                   \"same URL twice: %r\" % ir.path)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "215", "colour": "orange", "code": "                            else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "216", "colour": "orange", "code": "                                # Add the *previous* path_info + qs to redirections.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "217", "colour": "orange", "code": "                                if qs:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "218", "colour": "orange", "code": "                                    qs = \"?\" + qs\n", "error": "none", "author": "tom@organisms.be"}, {"index": "219", "colour": "orange", "code": "                                redirections.append(sn + path + qs)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "220", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "221", "colour": "orange", "code": "                        # Munge environment and try again.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "222", "colour": "orange", "code": "                        method = \"GET\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "223", "colour": "orange", "code": "                        path = ir.path\n", "error": "none", "author": "tom@organisms.be"}, {"index": "224", "colour": "orange", "code": "                        qs = ir.query_string\n", "error": "none", "author": "tom@organisms.be"}, {"index": "225", "colour": "orange", "code": "                        rfile = BytesIO()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "226", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "227", "colour": "orange", "code": "                send_response(req, response.output_status, response.header_list,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "228", "colour": "orange", "code": "                              response.body, response.stream)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "229", "colour": "orange", "code": "            finally:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "230", "colour": "orange", "code": "                app.release_serving()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "231", "colour": "green", "code": "    except:\n", "error": "W", "author": "tom@organisms.be"}, {"index": "232", "colour": "orange", "code": "        tb = format_exc()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "233", "colour": "orange", "code": "        cherrypy.log(tb, 'MOD_PYTHON', severity=logging.ERROR)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "234", "colour": "orange", "code": "        s, h, b = bare_error()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "235", "colour": "orange", "code": "        send_response(req, s, h, b)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "236", "colour": "orange", "code": "    return apache.OK\n", "error": "none", "author": "tom@organisms.be"}, {"index": "237", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "238", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "239", "colour": "orange", "code": "def send_response(req, status, headers, body, stream=False):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "240", "colour": "orange", "code": "    # Set response status\n", "error": "none", "author": "tom@organisms.be"}, {"index": "241", "colour": "orange", "code": "    req.status = int(status[:3])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "242", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "243", "colour": "orange", "code": "    # Set response headers\n", "error": "none", "author": "tom@organisms.be"}, {"index": "244", "colour": "orange", "code": "    req.content_type = \"text/plain\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "245", "colour": "orange", "code": "    for header, value in headers:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "246", "colour": "orange", "code": "        if header.lower() == 'content-type':\n", "error": "none", "author": "tom@organisms.be"}, {"index": "247", "colour": "orange", "code": "            req.content_type = value\n", "error": "none", "author": "tom@organisms.be"}, {"index": "248", "colour": "orange", "code": "            continue\n", "error": "none", "author": "tom@organisms.be"}, {"index": "249", "colour": "orange", "code": "        req.headers_out.add(header, value)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "250", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "251", "colour": "orange", "code": "    if stream:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "252", "colour": "orange", "code": "        # Flush now so the status and headers are sent immediately.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "253", "colour": "orange", "code": "        req.flush()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "254", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "255", "colour": "orange", "code": "    # Set response body\n", "error": "none", "author": "tom@organisms.be"}, {"index": "256", "colour": "orange", "code": "    if isinstance(body, basestring):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "257", "colour": "orange", "code": "        req.write(body)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "258", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "259", "colour": "orange", "code": "        for seg in body:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "260", "colour": "orange", "code": "            req.write(seg)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "261", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "262", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "263", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "264", "colour": "orange", "code": "# --------------- Startup tools for CherryPy + mod_python --------------- #\n", "error": "none", "author": "tom@organisms.be"}, {"index": "265", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "266", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "267", "colour": "orange", "code": "import os\n", "error": "none", "author": "tom@organisms.be"}, {"index": "268", "colour": "orange", "code": "import re\n", "error": "none", "author": "tom@organisms.be"}, {"index": "269", "colour": "orange", "code": "try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "270", "colour": "orange", "code": "    import subprocess\n", "error": "none", "author": "tom@organisms.be"}, {"index": "271", "colour": "orange", "code": "    def popen(fullcmd):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "272", "colour": "orange", "code": "        p = subprocess.Popen(fullcmd, shell=True,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "273", "colour": "orange", "code": "                             stdout=subprocess.PIPE, stderr=subprocess.STDOUT,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "274", "colour": "orange", "code": "                             close_fds=True)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "275", "colour": "orange", "code": "        return p.stdout\n", "error": "none", "author": "tom@organisms.be"}, {"index": "276", "colour": "orange", "code": "except ImportError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "277", "colour": "orange", "code": "    def popen(fullcmd):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "278", "colour": "green", "code": "        pipein, pipeout = os.popen4(fullcmd)\n", "error": "W", "author": "tom@organisms.be"}, {"index": "279", "colour": "orange", "code": "        return pipeout\n", "error": "none", "author": "tom@organisms.be"}, {"index": "280", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "281", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "282", "colour": "orange", "code": "def read_process(cmd, args=\"\"):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "283", "colour": "orange", "code": "    fullcmd = \"%s %s\" % (cmd, args)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "284", "colour": "orange", "code": "    pipeout = popen(fullcmd)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "285", "colour": "orange", "code": "    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "286", "colour": "orange", "code": "        firstline = pipeout.readline()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "287", "colour": "orange", "code": "        if (re.search(ntob(\"(not recognized|No such file|not found)\"), firstline,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "288", "colour": "orange", "code": "                      re.IGNORECASE)):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "289", "colour": "orange", "code": "            raise IOError('%s must be on your system path.' % cmd)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "290", "colour": "orange", "code": "        output = firstline + pipeout.read()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "291", "colour": "orange", "code": "    finally:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "292", "colour": "orange", "code": "        pipeout.close()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "293", "colour": "orange", "code": "    return output\n", "error": "none", "author": "tom@organisms.be"}, {"index": "294", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "295", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "296", "colour": "orange", "code": "class ModPythonServer(object):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "297", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "298", "colour": "orange", "code": "    template = \"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "299", "colour": "orange", "code": "# Apache2 server configuration file for running CherryPy with mod_python.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "300", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "301", "colour": "orange", "code": "DocumentRoot \"/\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "302", "colour": "orange", "code": "Listen %(port)s\n", "error": "none", "author": "tom@organisms.be"}, {"index": "303", "colour": "orange", "code": "LoadModule python_module modules/mod_python.so\n", "error": "none", "author": "tom@organisms.be"}, {"index": "304", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "305", "colour": "orange", "code": "<Location %(loc)s>\n", "error": "none", "author": "tom@organisms.be"}, {"index": "306", "colour": "orange", "code": "    SetHandler python-program\n", "error": "none", "author": "tom@organisms.be"}, {"index": "307", "colour": "orange", "code": "    PythonHandler %(handler)s\n", "error": "none", "author": "tom@organisms.be"}, {"index": "308", "colour": "orange", "code": "    PythonDebug On\n", "error": "none", "author": "tom@organisms.be"}, {"index": "309", "colour": "orange", "code": "%(opts)s\n", "error": "none", "author": "tom@organisms.be"}, {"index": "310", "colour": "orange", "code": "</Location>\n", "error": "none", "author": "tom@organisms.be"}, {"index": "311", "colour": "orange", "code": "\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "312", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "313", "colour": "blue", "code": "    def __init__(self, loc=\"/\", port=80, opts=None, apache_path=\"apache\",\n", "error": "R", "author": "tom@organisms.be"}, {"index": "314", "colour": "green", "code": "                 handler=\"cherrypy._cpmodpy::handler\"):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "315", "colour": "orange", "code": "        self.loc = loc\n", "error": "none", "author": "tom@organisms.be"}, {"index": "316", "colour": "orange", "code": "        self.port = port\n", "error": "none", "author": "tom@organisms.be"}, {"index": "317", "colour": "orange", "code": "        self.opts = opts\n", "error": "none", "author": "tom@organisms.be"}, {"index": "318", "colour": "orange", "code": "        self.apache_path = apache_path\n", "error": "none", "author": "tom@organisms.be"}, {"index": "319", "colour": "orange", "code": "        self.handler = handler\n", "error": "none", "author": "tom@organisms.be"}, {"index": "320", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "321", "colour": "orange", "code": "    def start(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "322", "colour": "orange", "code": "        opts = \"\".join([\"    PythonOption %s %s\\n\" % (k, v)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "323", "colour": "orange", "code": "                        for k, v in self.opts])\n", "error": "none", "author": "tom@organisms.be"}, {"index": "324", "colour": "orange", "code": "        conf_data = self.template % {\"port\": self.port,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "325", "colour": "orange", "code": "                                     \"loc\": self.loc,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "326", "colour": "orange", "code": "                                     \"opts\": opts,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "327", "colour": "orange", "code": "                                     \"handler\": self.handler,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "328", "colour": "orange", "code": "                                     }\n", "error": "none", "author": "tom@organisms.be"}, {"index": "329", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "330", "colour": "orange", "code": "        mpconf = os.path.join(os.path.dirname(__file__), \"cpmodpy.conf\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "331", "colour": "orange", "code": "        f = open(mpconf, 'wb')\n", "error": "none", "author": "tom@organisms.be"}, {"index": "332", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "333", "colour": "orange", "code": "            f.write(conf_data)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "334", "colour": "orange", "code": "        finally:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "335", "colour": "orange", "code": "            f.close()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "336", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "337", "colour": "orange", "code": "        response = read_process(self.apache_path, \"-k start -f %s\" % mpconf)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "338", "colour": "green", "code": "        self.ready = True\n", "error": "W", "author": "tom@organisms.be"}, {"index": "339", "colour": "orange", "code": "        return response\n", "error": "none", "author": "tom@organisms.be"}, {"index": "340", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "341", "colour": "orange", "code": "    def stop(self):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "342", "colour": "orange", "code": "        os.popen(\"apache -k stop\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "343", "colour": "green", "code": "        self.ready = False\n", "error": "W", "author": "tom@organisms.be"}, {"index": "344", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}]]}