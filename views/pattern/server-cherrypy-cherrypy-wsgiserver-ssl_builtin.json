{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/wsgiserver/ssl_builtin.py", "lines": [[{"index": "1", "colour": "orange", "code": "\"\"\"A library for integrating Python's builtin ``ssl`` library with CherryPy.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "2", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "3", "colour": "orange", "code": "The ssl module must be importable for SSL functionality.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "4", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "5", "colour": "orange", "code": "To use this module, set ``CherryPyWSGIServer.ssl_adapter`` to an instance of\n", "error": "none", "author": "tom@organisms.be"}, {"index": "6", "colour": "orange", "code": "``BuiltinSSLAdapter``.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "7", "colour": "orange", "code": "\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "8", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "9", "colour": "orange", "code": "try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "10", "colour": "orange", "code": "    import ssl\n", "error": "none", "author": "tom@organisms.be"}, {"index": "11", "colour": "orange", "code": "except ImportError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "12", "colour": "orange", "code": "    ssl = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "13", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "14", "colour": "orange", "code": "try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "15", "colour": "orange", "code": "    from _pyio import DEFAULT_BUFFER_SIZE\n", "error": "none", "author": "tom@organisms.be"}, {"index": "16", "colour": "orange", "code": "except ImportError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "17", "colour": "orange", "code": "    try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "18", "colour": "orange", "code": "        from io import DEFAULT_BUFFER_SIZE\n", "error": "none", "author": "tom@organisms.be"}, {"index": "19", "colour": "orange", "code": "    except ImportError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "20", "colour": "orange", "code": "        DEFAULT_BUFFER_SIZE = -1\n", "error": "none", "author": "tom@organisms.be"}, {"index": "21", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "22", "colour": "orange", "code": "import sys\n", "error": "none", "author": "tom@organisms.be"}, {"index": "23", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "24", "colour": "orange", "code": "from cherrypy import wsgiserver\n", "error": "none", "author": "tom@organisms.be"}, {"index": "25", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "26", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "27", "colour": "orange", "code": "class BuiltinSSLAdapter(wsgiserver.SSLAdapter):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "28", "colour": "orange", "code": "    \"\"\"A wrapper for integrating Python's builtin ssl module with CherryPy.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "29", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "30", "colour": "orange", "code": "    certificate = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "31", "colour": "orange", "code": "    \"\"\"The filename of the server SSL certificate.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "32", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "33", "colour": "orange", "code": "    private_key = None\n", "error": "none", "author": "tom@organisms.be"}, {"index": "34", "colour": "orange", "code": "    \"\"\"The filename of the server's private key file.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "35", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "36", "colour": "green", "code": "    def __init__(self, certificate, private_key, certificate_chain=None):\n", "error": "W", "author": "tom@organisms.be"}, {"index": "37", "colour": "orange", "code": "        if ssl is None:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "38", "colour": "orange", "code": "            raise ImportError(\"You must install the ssl module to use HTTPS.\")\n", "error": "none", "author": "tom@organisms.be"}, {"index": "39", "colour": "orange", "code": "        self.certificate = certificate\n", "error": "none", "author": "tom@organisms.be"}, {"index": "40", "colour": "orange", "code": "        self.private_key = private_key\n", "error": "none", "author": "tom@organisms.be"}, {"index": "41", "colour": "orange", "code": "        self.certificate_chain = certificate_chain\n", "error": "none", "author": "tom@organisms.be"}, {"index": "42", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "43", "colour": "blue", "code": "    def bind(self, sock):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "44", "colour": "orange", "code": "        \"\"\"Wrap and return the given socket.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "45", "colour": "orange", "code": "        return sock\n", "error": "none", "author": "tom@organisms.be"}, {"index": "46", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "47", "colour": "orange", "code": "    def wrap(self, sock):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "48", "colour": "orange", "code": "        \"\"\"Wrap and return the given socket, plus WSGI environ entries.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "49", "colour": "orange", "code": "        try:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "50", "colour": "orange", "code": "            s = ssl.wrap_socket(sock, do_handshake_on_connect=True,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "51", "colour": "orange", "code": "                    server_side=True, certfile=self.certificate,\n", "error": "none", "author": "tom@organisms.be"}, {"index": "52", "colour": "orange", "code": "                    keyfile=self.private_key, ssl_version=ssl.PROTOCOL_SSLv23)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "53", "colour": "orange", "code": "        except ssl.SSLError:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "54", "colour": "orange", "code": "            e = sys.exc_info()[1]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "55", "colour": "orange", "code": "            if e.errno == ssl.SSL_ERROR_EOF:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "56", "colour": "orange", "code": "                # This is almost certainly due to the cherrypy engine\n", "error": "none", "author": "tom@organisms.be"}, {"index": "57", "colour": "orange", "code": "                # 'pinging' the socket to assert it's connectable;\n", "error": "none", "author": "tom@organisms.be"}, {"index": "58", "colour": "orange", "code": "                # the 'ping' isn't SSL.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "59", "colour": "orange", "code": "                return None, {}\n", "error": "none", "author": "tom@organisms.be"}, {"index": "60", "colour": "orange", "code": "            elif e.errno == ssl.SSL_ERROR_SSL:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "61", "colour": "orange", "code": "                if e.args[1].endswith('http request'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "62", "colour": "orange", "code": "                    # The client is speaking HTTP to an HTTPS server.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "63", "colour": "orange", "code": "                    raise wsgiserver.NoSSLError\n", "error": "none", "author": "tom@organisms.be"}, {"index": "64", "colour": "orange", "code": "                elif e.args[1].endswith('unknown protocol'):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "65", "colour": "orange", "code": "                    # The client is speaking some non-HTTP protocol.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "66", "colour": "orange", "code": "                    # Drop the conn.\n", "error": "none", "author": "tom@organisms.be"}, {"index": "67", "colour": "orange", "code": "                    return None, {}\n", "error": "none", "author": "tom@organisms.be"}, {"index": "68", "colour": "orange", "code": "            raise\n", "error": "none", "author": "tom@organisms.be"}, {"index": "69", "colour": "orange", "code": "        return s, self.get_environ(s)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "70", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "71", "colour": "green", "code": "    # TODO: fill this out more with mod ssl env\n", "error": "W", "author": "tom@organisms.be"}, {"index": "72", "colour": "blue", "code": "    def get_environ(self, sock):\n", "error": "R", "author": "tom@organisms.be"}, {"index": "73", "colour": "orange", "code": "        \"\"\"Create WSGI environ entries to be merged into each request.\"\"\"\n", "error": "none", "author": "tom@organisms.be"}, {"index": "74", "colour": "orange", "code": "        cipher = sock.cipher()\n", "error": "none", "author": "tom@organisms.be"}, {"index": "75", "colour": "orange", "code": "        ssl_environ = {\n", "error": "none", "author": "tom@organisms.be"}, {"index": "76", "colour": "orange", "code": "            \"wsgi.url_scheme\": \"https\",\n", "error": "none", "author": "tom@organisms.be"}, {"index": "77", "colour": "orange", "code": "            \"HTTPS\": \"on\",\n", "error": "none", "author": "tom@organisms.be"}, {"index": "78", "colour": "orange", "code": "            'SSL_PROTOCOL': cipher[1],\n", "error": "none", "author": "tom@organisms.be"}, {"index": "79", "colour": "orange", "code": "            'SSL_CIPHER': cipher[0]\n", "error": "none", "author": "tom@organisms.be"}, {"index": "80", "colour": "orange", "code": "##            SSL_VERSION_INTERFACE \tstring \tThe mod_ssl program version\n", "error": "none", "author": "tom@organisms.be"}, {"index": "81", "colour": "orange", "code": "##            SSL_VERSION_LIBRARY \tstring \tThe OpenSSL program version\n", "error": "none", "author": "tom@organisms.be"}, {"index": "82", "colour": "orange", "code": "            }\n", "error": "none", "author": "tom@organisms.be"}, {"index": "83", "colour": "orange", "code": "        return ssl_environ\n", "error": "none", "author": "tom@organisms.be"}, {"index": "84", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}, {"index": "85", "colour": "orange", "code": "    if sys.version_info >= (3, 0):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "86", "colour": "orange", "code": "        def makefile(self, sock, mode='r', bufsize=DEFAULT_BUFFER_SIZE):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "87", "colour": "red", "code": "            return wsgiserver.CP_makefile(sock, mode, bufsize)\n", "error": "E", "author": "tom@organisms.be"}, {"index": "88", "colour": "orange", "code": "    else:\n", "error": "none", "author": "tom@organisms.be"}, {"index": "89", "colour": "orange", "code": "        def makefile(self, sock, mode='r', bufsize=DEFAULT_BUFFER_SIZE):\n", "error": "none", "author": "tom@organisms.be"}, {"index": "90", "colour": "orange", "code": "            return wsgiserver.CP_fileobject(sock, mode, bufsize)\n", "error": "none", "author": "tom@organisms.be"}, {"index": "91", "colour": "orange", "code": "\n", "error": "none", "author": "tom@organisms.be"}]]}