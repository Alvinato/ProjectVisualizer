{"path": "/home/asumal/git/cs410/pattern/pattern/server/cherrypy/cherrypy/wsgiserver/ssl_pyopenssl.py", "lines": [[{"error": "none", "line": "1", "code": "\"\"\"A library for integrating pyOpenSSL with CherryPy.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "2", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "3", "code": "The OpenSSL module must be importable for SSL functionality.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "4", "code": "You can obtain it from http://pyopenssl.sourceforge.net/\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "5", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "6", "code": "To use this module, set CherryPyWSGIServer.ssl_adapter to an instance of\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "7", "code": "SSLAdapter. There are two ways to use SSL:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "8", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "9", "code": "Method One\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "10", "code": "----------\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "11", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "12", "code": " * ``ssl_adapter.context``: an instance of SSL.Context.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "13", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "14", "code": "If this is not None, it is assumed to be an SSL.Context instance,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "15", "code": "and will be passed to SSL.Connection on bind(). The developer is\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "16", "code": "responsible for forming a valid Context object. This approach is\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "17", "code": "to be preferred for more flexibility, e.g. if the cert and key are\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "18", "code": "streams instead of files, or need decryption, or SSL.SSLv3_METHOD\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "19", "code": "is desired instead of the default SSL.SSLv23_METHOD, etc. Consult\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "20", "code": "the pyOpenSSL documentation for complete options.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "21", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "22", "code": "Method Two (shortcut)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "23", "code": "---------------------\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "24", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "25", "code": " * ``ssl_adapter.certificate``: the filename of the server SSL certificate.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "26", "code": " * ``ssl_adapter.private_key``: the filename of the server's private key file.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "27", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "28", "code": "Both are None by default. If ssl_adapter.context is None, but .private_key\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "29", "code": "and .certificate are both given and valid, they will be read, and the\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "30", "code": "context will be automatically created from them.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "31", "code": "\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "32", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "33", "code": "import socket\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "34", "code": "import threading\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "35", "code": "import time\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "36", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "37", "code": "from cherrypy import wsgiserver\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "38", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "39", "code": "try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "40", "code": "    from OpenSSL import SSL\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "41", "code": "    from OpenSSL import crypto\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "42", "code": "except ImportError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "43", "code": "    SSL = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "44", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "45", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "46", "code": "class SSL_fileobject(wsgiserver.CP_fileobject):\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "47", "code": "    \"\"\"SSL file object attached to a socket object.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "48", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "49", "code": "    ssl_timeout = 3\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "50", "code": "    ssl_retry = .01\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "51", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "52", "code": "    def _safe_call(self, is_reader, call, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "53", "code": "        \"\"\"Wrap the given call with SSL error-trapping.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "54", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "55", "code": "        is_reader: if False EOF errors will be raised. If True, EOF errors\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "56", "code": "        will return \"\" (to emulate normal sockets).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "57", "code": "        \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "58", "code": "        start = time.time()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "59", "code": "        while True:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "60", "code": "            try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "61", "code": "                return call(*args, **kwargs)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "62", "code": "            except SSL.WantReadError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "63", "code": "                # Sleep and try again. This is dangerous, because it means\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "64", "code": "                # the rest of the stack has no way of differentiating\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "65", "code": "                # between a \"new handshake\" error and \"client dropped\".\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "66", "code": "                # Note this isn't an endless loop: there's a timeout below.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "67", "code": "                time.sleep(self.ssl_retry)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "68", "code": "            except SSL.WantWriteError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "69", "code": "                time.sleep(self.ssl_retry)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "70", "code": "            except SSL.SysCallError as e:\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "71", "code": "                if is_reader and e.args == (-1, 'Unexpected EOF'):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "72", "code": "                    return \"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "73", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "74", "code": "                errnum = e.args[0]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "E", "line": "75", "code": "                if is_reader and errnum in wsgiserver.socket_errors_to_ignore:\n", "colour": "yellow", "author": "tom@organisms.be"}, {"error": "none", "line": "76", "code": "                    return \"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "77", "code": "                raise socket.error(errnum)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "78", "code": "            except SSL.Error as e:\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "79", "code": "                if is_reader and e.args == (-1, 'Unexpected EOF'):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "80", "code": "                    return \"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "81", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "82", "code": "                thirdarg = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "83", "code": "                try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "84", "code": "                    thirdarg = e.args[0][0][2]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "85", "code": "                except IndexError:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "86", "code": "                    pass\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "87", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "88", "code": "                if thirdarg == 'http request':\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "89", "code": "                    # The client is talking HTTP to an HTTPS server.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "90", "code": "                    raise wsgiserver.NoSSLError()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "91", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "92", "code": "                raise wsgiserver.FatalSSLAlert(*e.args)\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "93", "code": "            except:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "94", "code": "                raise\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "95", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "96", "code": "            if time.time() - start > self.ssl_timeout:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "97", "code": "                raise socket.timeout(\"timed out\")\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "98", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "99", "code": "    def recv(self, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "100", "code": "        buf = []\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "101", "code": "        r = super(SSL_fileobject, self).recv\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "102", "code": "        while True:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "103", "code": "            data = self._safe_call(True, r, *args, **kwargs)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "104", "code": "            buf.append(data)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "105", "code": "            p = self._sock.pending()\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "106", "code": "            if not p:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "107", "code": "                return \"\".join(buf)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "108", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "109", "code": "    def sendall(self, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "110", "code": "        return self._safe_call(False, super(SSL_fileobject, self).sendall,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "111", "code": "                               *args, **kwargs)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "112", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "113", "code": "    def send(self, *args, **kwargs):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "114", "code": "        return self._safe_call(False, super(SSL_fileobject, self).send,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "115", "code": "                               *args, **kwargs)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "116", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "117", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "R", "line": "118", "code": "class SSLConnection:\n", "colour": "green", "author": "tom@organisms.be"}, {"error": "none", "line": "119", "code": "    \"\"\"A thread-safe wrapper for an SSL.Connection.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "120", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "121", "code": "    ``*args``: the arguments to create the wrapped ``SSL.Connection(*args)``.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "122", "code": "    \"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "123", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "124", "code": "    def __init__(self, *args):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "125", "code": "        self._ssl_conn = SSL.Connection(*args)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "126", "code": "        self._lock = threading.RLock()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "127", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "128", "code": "    for f in ('get_context', 'pending', 'send', 'write', 'recv', 'read',\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "129", "code": "              'renegotiate', 'bind', 'listen', 'connect', 'accept',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "130", "code": "              'setblocking', 'fileno', 'close', 'get_cipher_list',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "131", "code": "              'getpeername', 'getsockname', 'getsockopt', 'setsockopt',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "132", "code": "              'makefile', 'get_app_data', 'set_app_data', 'state_string',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "133", "code": "              'sock_shutdown', 'get_peer_certificate', 'want_read',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "134", "code": "              'want_write', 'set_connect_state', 'set_accept_state',\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "135", "code": "              'connect_ex', 'sendall', 'settimeout', 'gettimeout'):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "136", "code": "        exec(\"\"\"def %s(self, *args):\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "137", "code": "        self._lock.acquire()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "138", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "139", "code": "            return self._ssl_conn.%s(*args)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "140", "code": "        finally:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "141", "code": "            self._lock.release()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "142", "code": "\"\"\" % (f, f))\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "143", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "144", "code": "    def shutdown(self, *args):\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "145", "code": "        self._lock.acquire()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "146", "code": "        try:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "147", "code": "            # pyOpenSSL.socket.shutdown takes no args\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "148", "code": "            return self._ssl_conn.shutdown()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "149", "code": "        finally:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "150", "code": "            self._lock.release()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "151", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "152", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "153", "code": "class pyOpenSSLAdapter(wsgiserver.SSLAdapter):\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "154", "code": "    \"\"\"A wrapper for integrating pyOpenSSL with CherryPy.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "155", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "156", "code": "    context = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "157", "code": "    \"\"\"An instance of SSL.Context.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "158", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "159", "code": "    certificate = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "160", "code": "    \"\"\"The filename of the server SSL certificate.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "161", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "162", "code": "    private_key = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "163", "code": "    \"\"\"The filename of the server's private key file.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "164", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "165", "code": "    certificate_chain = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "166", "code": "    \"\"\"Optional. The filename of CA's intermediate certificate bundle.\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "167", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "168", "code": "    This is needed for cheaper \"chained root\" SSL certificates, and should be\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "169", "code": "    left as None if not required.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "170", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "W", "line": "171", "code": "    def __init__(self, certificate, private_key, certificate_chain=None):\n", "colour": "purple", "author": "tom@organisms.be"}, {"error": "none", "line": "172", "code": "        if SSL is None:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "173", "code": "            raise ImportError(\"You must install pyOpenSSL to use HTTPS.\")\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "174", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "175", "code": "        self.context = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "176", "code": "        self.certificate = certificate\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "177", "code": "        self.private_key = private_key\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "178", "code": "        self.certificate_chain = certificate_chain\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "179", "code": "        self._environ = None\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "180", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "181", "code": "    def bind(self, sock):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "182", "code": "        \"\"\"Wrap and return the given socket.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "183", "code": "        if self.context is None:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "184", "code": "            self.context = self.get_context()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "185", "code": "        conn = SSLConnection(self.context, sock)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "186", "code": "        self._environ = self.get_environ()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "187", "code": "        return conn\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "188", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "189", "code": "    def wrap(self, sock):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "190", "code": "        \"\"\"Wrap and return the given socket, plus WSGI environ entries.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "191", "code": "        return sock, self._environ.copy()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "192", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "193", "code": "    def get_context(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "194", "code": "        \"\"\"Return an SSL.Context from self attributes.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "195", "code": "        # See http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/442473\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "196", "code": "        c = SSL.Context(SSL.SSLv23_METHOD)\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "197", "code": "        c.use_privatekey_file(self.private_key)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "198", "code": "        if self.certificate_chain:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "199", "code": "            c.load_verify_locations(self.certificate_chain)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "200", "code": "        c.use_certificate_file(self.certificate)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "201", "code": "        return c\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "202", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "203", "code": "    def get_environ(self):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "204", "code": "        \"\"\"Return WSGI environ entries to be merged into each request.\"\"\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "205", "code": "        ssl_environ = {\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "206", "code": "            \"HTTPS\": \"on\",\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "207", "code": "            # pyOpenSSL doesn't provide access to any of these AFAICT\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "208", "code": "##            'SSL_PROTOCOL': 'SSLv2',\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "209", "code": "##            SSL_CIPHER \tstring \tThe cipher specification name\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "210", "code": "##            SSL_VERSION_INTERFACE \tstring \tThe mod_ssl program version\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "211", "code": "##            SSL_VERSION_LIBRARY \tstring \tThe OpenSSL program version\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "212", "code": "            }\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "213", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "214", "code": "        if self.certificate:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "215", "code": "            # Server certificate attributes\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "216", "code": "            cert = open(self.certificate, 'rb').read()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "217", "code": "            cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "218", "code": "            ssl_environ.update({\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "219", "code": "                'SSL_SERVER_M_VERSION': cert.get_version(),\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "220", "code": "                'SSL_SERVER_M_SERIAL': cert.get_serial_number(),\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "221", "code": "##                'SSL_SERVER_V_START': Validity of server's certificate (start time),\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "C", "line": "222", "code": "##                'SSL_SERVER_V_END': Validity of server's certificate (end time),\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "223", "code": "                })\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "224", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "225", "code": "            for prefix, dn in [(\"I\", cert.get_issuer()),\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "226", "code": "                               (\"S\", cert.get_subject())]:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "227", "code": "                # X509Name objects don't seem to have a way to get the\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "228", "code": "                # complete DN string. Use str() and slice it instead,\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "229", "code": "                # because str(dn) == \"<X509Name object '/C=US/ST=...'>\"\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "230", "code": "                dnstr = str(dn)[18:-2]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "231", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "232", "code": "                wsgikey = 'SSL_SERVER_%s_DN' % prefix\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "233", "code": "                ssl_environ[wsgikey] = dnstr\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "234", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "235", "code": "                # The DN should be of the form: /k1=v1/k2=v2, but we must allow\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "236", "code": "                # for any value to contain slashes itself (in a URL).\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "237", "code": "                while dnstr:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "238", "code": "                    pos = dnstr.rfind(\"=\")\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "239", "code": "                    dnstr, value = dnstr[:pos], dnstr[pos + 1:]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "240", "code": "                    pos = dnstr.rfind(\"/\")\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "241", "code": "                    dnstr, key = dnstr[:pos], dnstr[pos + 1:]\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "242", "code": "                    if key and value:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "243", "code": "                        wsgikey = 'SSL_SERVER_%s_DN_%s' % (prefix, key)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "244", "code": "                        ssl_environ[wsgikey] = value\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "245", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "246", "code": "        return ssl_environ\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "247", "code": "\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "248", "code": "    def makefile(self, sock, mode='r', bufsize=-1):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "249", "code": "        if SSL and isinstance(sock, SSL.ConnectionType):\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "250", "code": "            timeout = sock.gettimeout()\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "C", "line": "251", "code": "            f = SSL_fileobject(sock, mode, bufsize)\n", "colour": "blue", "author": "tom@organisms.be"}, {"error": "none", "line": "252", "code": "            f.ssl_timeout = timeout\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "253", "code": "            return f\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "254", "code": "        else:\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "255", "code": "            return wsgiserver.CP_fileobject(sock, mode, bufsize)\n", "colour": "black", "author": "tom@organisms.be"}, {"error": "none", "line": "256", "code": "\n", "colour": "black", "author": "tom@organisms.be"}]]}